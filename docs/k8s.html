



















<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bkl - Layered Configuration Language</title>
<link rel="icon" href="icon.png">
<style>
:root {
	--vivid0: hsl(6deg 96% 26%);
	--vivid1: hsl(8deg 92% 35%);
	--vivid2: hsl(10deg 93% 40%);
	--vivid3: hsl(12deg 86% 47%);
	--vivid4: hsl(14deg 89% 55%);
	--vivid5: hsl(16deg 94% 61%);
	--vivid6: hsl(18deg 100% 70%);
	--vivid7: hsl(20deg 100% 77%);
	--vivid8: hsl(22deg 100% 85%);
	--vivid9: hsl(24deg 100% 93%);
	--neutral0: hsl(210deg 24% 16%);
	--neutral1: hsl(209deg 20% 25%);
	--neutral2: hsl(209deg 18% 30%);
	--neutral3: hsl(209deg 14% 37%);
	--neutral4: hsl(211deg 12% 43%);
	--neutral5: hsl(211deg 10% 53%);
	--neutral6: hsl(211deg 13% 65%);
	--neutral7: hsl(210deg 16% 82%);
	--neutral8: hsl(214deg 15% 91%);
	--neutral9: hsl(216deg 33% 97%);
	--blue0: hsl(234deg 62% 26%);
	--blue1: hsl(232deg 51% 36%);
	--blue2: hsl(230deg 49% 41%);
	--blue3: hsl(228deg 45% 45%);
	--blue4: hsl(227deg 42% 51%);
	--blue5: hsl(227deg 50% 59%);
	--blue6: hsl(225deg 57% 67%);
	--blue7: hsl(224deg 67% 76%);
	--blue8: hsl(221deg 78% 86%);
	--blue9: hsl(221deg 68% 93%);
	--red0: hsl(360deg 92% 20%);
	--red1: hsl(360deg 85% 25%);
	--red2: hsl(360deg 79% 32%);
	--red3: hsl(360deg 72% 38%);
	--red4: hsl(360deg 67% 44%);
	--red5: hsl(360deg 64% 55%);
	--red6: hsl(360deg 71% 66%);
	--red7: hsl(360deg 77% 78%);
	--red8: hsl(360deg 82% 89%);
	--red9: hsl(360deg 100% 97%);
	--yellow0: hsl(43deg 86% 17%);
	--yellow1: hsl(43deg 77% 27%);
	--yellow2: hsl(43deg 72% 37%);
	--yellow3: hsl(42deg 63% 48%);
	--yellow4: hsl(42deg 78% 60%);
	--yellow5: hsl(43deg 89% 70%);
	--yellow6: hsl(43deg 90% 76%);
	--yellow7: hsl(45deg 86% 81%);
	--yellow8: hsl(45deg 90% 88%);
	--yellow9: hsl(45deg 100% 96%);
	--green0: hsl(125deg 86% 14%);
	--green1: hsl(125deg 73% 20%);
	--green2: hsl(125deg 56% 29%);
	--green3: hsl(122deg 47% 35%);
	--green4: hsl(122deg 39% 41%);
	--green5: hsl(123deg 35% 51%);
	--green6: hsl(123deg 38% 63%);
	--green7: hsl(122deg 42% 75%);
	--green8: hsl(126deg 49% 84%);
	--green9: hsl(125deg 65% 93%);
	
	 
	--gap-small: 15px;
	--gap-large: 20px;
	--padding-code: 15px;
	--padding-label: 6px 15px 4px 15px;
	--border-radius: 5px;
	--border-radius-label: 0 5px 5px 5px;
	--operator-size: 30px;
	--operator-padding-top: 27px;
}

@font-face {
	font-family: "komet";
	src: url("komet.woff2");
}

@font-face {
	font-family: "source-code-pro";
	src: url("source-code-pro.woff2");
}

body {
	align-items: stretch;
	background-color: var(--neutral9);
	color: var(--neutral1);
	display: flex;
	font-family: "komet";
	font-size: 17px;
	gap: 50px;
	justify-content: center;
	line-height: 1.4;
	margin: 0;
	min-height: 100vh;
	padding: 20px;
}

nav {
	position: fixed;
	left: 20px;
	top: 20px;
	bottom: 20px;
	width: 200px;
	display: flex;
	flex-direction: column;
}

nav {
	position: relative;
}

nav .nav-scroll-container {
	overflow-y: auto;
	flex: 1;
	margin-top: 10px;
}


nav ol {
	list-style: none;
	margin: 0;
	padding: 0;
}

li {
	padding-bottom: 10px;
}

nav a {
	color: var(--neutral5);
	text-decoration: none;
	font-family: source-code-pro;
}

nav a:hover {
	color: var(--neutral3);
}

main {
	max-width: min(750px, 100vw - 20px);
	margin-left: 250px;
}

h1, h2 {
	margin-bottom: 5px;
	margin-top: 30px;
}

h1 {
	align-items: center;
	color: var(--vivid4);
	display: flex;
	font-size: 30px;
	gap: 10px;
	margin: 0;
	padding: 10px 0 10px 0;
	position: relative;
}

h2 {
	color: var(--vivid2);
	font-family: source-code-pro;
	font-size: 25px;
}

h2 a {
	color: inherit;
	text-decoration: none;
}

p {
	hyphens: auto;
	margin: 0 0 10px 0;
}

a {
	color: var(--blue3);
}

label {
	background: var(--neutral2);
	border-radius: var(--border-radius) var(--border-radius) 0 0;
	color: var(--neutral8);
	font-family: source-code-pro;
	display: block;
	padding: var(--padding-label);
	width: fit-content;
}

label.invisible {
	background: transparent;
	color: transparent;
}

bkl-code {
	color: var(--neutral7);
	background: var(--neutral0);
	border-radius: var(--border-radius);
	display: block;
	font-family: source-code-pro;
	font-size: 16px;
	height: fit-content;
	hyphens: none;
	line-height: 1.5;
	overflow-x: auto;
	overflow-y: auto;
	padding: var(--padding-code);
	tab-size: 4;
	text-align: left;
	white-space: pre;
	width: 100%;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	box-sizing: border-box;
	max-width: 100%;
	min-width: 0;
}



 
label:not(.invisible) + bkl-code {
	border-top-left-radius: 0 !important;
}

 
label.invisible + bkl-code {
	border-top-left-radius: 4px !important;
}

bkl-code + p,
div:has(> bkl-code) + p {
	margin-top: 10px;
}

row {
	display: block;
	max-width: 100%;
	overflow: hidden;
}


op {
	align-items: center;
	display: flex;
	font-size: 30px;
	justify-content: center;
	line-height: 0.5;
	text-align: center;
	white-space: pre;
}

 
.code-container {
	display: flex;
	flex-direction: column;
	min-width: 0;
	overflow: hidden;
}

.example-container {
	display: flex;
	flex-direction: column;
	gap: var(--gap-small);
	margin: var(--gap-large) 0;
}

.example-container.fixit-3-layer {
	gap: 5px;
}

.grid-container {
	display: grid;
	align-items: stretch;
	column-gap: var(--gap-small);
	max-width: 100%;
	overflow: hidden;
}

.grid-2-col {
	grid-template-columns: 1fr 1fr;
}

.grid-3-col {
	grid-template-columns: 1fr auto 1fr;
}

.grid-5-col {
	grid-template-columns: 1fr auto 1fr auto 1fr;
}

.operator-symbol {
	align-items: center;
	display: flex;
	font-size: var(--operator-size);
	justify-content: center;
	line-height: 0.5;
	text-align: center;
	white-space: pre;
}

.operator-with-label {
	padding-top: var(--operator-padding-top);
}

.code-labeled {
	margin-top: 0;
	flex-grow: 1;
	border-radius: var(--border-radius-label);
	border-top-left-radius: 0;
}

.code-unlabeled {
	flex-grow: 1;
	height: 100%;
}

.label-container {
	display: flex;
	flex-direction: column;
	flex-shrink: 0;
}

.label-spacing {
	margin-bottom: 0;
}

.error-display {
	display: flex;
	align-items: center;
	justify-content: center;
	height: 100%;
	font-size: 24px;
	font-weight: bold;
}

 
.code-wrapper {
	position: relative;
}

.expand-toggle {
	position: absolute;
	top: 10px;
	right: 10px;
	z-index: 10;
	background: var(--blue4);
	color: var(--neutral9);
	border: 1px solid var(--blue3);
	border-radius: 3px;
	padding: 2px 8px;
	font-size: 14px;
	cursor: pointer;
	font-family: source-code-pro;
	transition: background-color 0.2s;
}

.expand-toggle:hover {
	background: var(--blue3);
}

bkl-code.collapsed {
	max-height: 90px;
	overflow: hidden;
	position: relative;
}

bkl-code.collapsed::after {
	content: '';
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: 40px;
	background: linear-gradient(to bottom, transparent, var(--neutral0));
	pointer-events: none;
}

key {
	color: var(--yellow4);
}

prompt {
	user-select: none;
	-webkit-user-select: none;
	color: var(--neutral5);
}

cmd {
	color: var(--blue5);
}

command {
	color: var(--blue5);
	font-weight: 500;
}

builtin {
	color: var(--blue5);
	font-weight: 500;
}

operator {
	color: var(--vivid5);
	font-weight: 600;
}

argument {
	color: var(--neutral8);
}

variable {
	color: var(--green5);
}

string {
	color: var(--green6);
}

number {
	color: var(--green6);
}

bool {
	color: var(--green6);
}

flag {
	color: var(--vivid3);
}

comment {
	color: var(--neutral5);
	font-style: italic;
}

keyword {
	color: var(--red5);
}

escape {
	color: var(--vivid3);
	font-weight: 600;
}

 
bkl-code highlight,
bkl-code highlight > * {
	color: var(--red6);
	background: transparent;
}

 
p highlight {
	background: var(--neutral8);
	color: var(--red6);
	display: inline-block;
	font-family: source-code-pro;
	font-size: 15px;
	padding: 0 3px 0 3px;
	white-space: nowrap;
}

p highlight * {
	color: var(--red6) !important;
}

 
addition {
	color: var(--green5);
}

deletion {
	color: var(--red5);
}

file-header {
	color: var(--blue5);
	font-weight: 500;
}

hunk-header {
	color: var(--vivid5);
	font-weight: 500;
}

 
.fixit-bad bkl-code,
.fixit-good bkl-code {
	position: relative;
}

.fixit-bad bkl-code::before {
	content: '✗';
	position: absolute;
	top: 10px;
	right: 10px;
	color: var(--red5);
	font-size: 20px;
	font-weight: bold;
	z-index: 10;
}

.fixit-bad bkl-code {
	border: 2px solid var(--red3);
}

.fixit-good bkl-code::before {
	content: '✓';
	position: absolute;
	top: 10px;
	right: 10px;
	color: var(--green5);
	font-size: 20px;
	font-weight: bold;
	z-index: 10;
}

.fixit-good bkl-code {
	border: 2px solid var(--green3);
}

 
.grid-container .fixit-bad,
.grid-container .fixit-good {
	display: flex;
	flex-direction: column;
}

.grid-container .fixit-bad .code-container,
.grid-container .fixit-good .code-container {
	flex: 1;
	display: flex;
	flex-direction: column;
}

 
.mobile-menu-button {
	display: none;
}

 
@media (max-width: 768px) {
	 
	:root {
		--padding-code: 10px;
		--padding-label: 5px 10px;
		--gap-small: 10px;
		--gap-large: 15px;
		--operator-size: 24px;
	}

	 
	body {
		padding: 10px;
		display: block;
	}

	nav {
		display: none;  
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: white;
		z-index: 1000;
		padding: 20px;
		overflow-y: auto;
	}

	nav.mobile-open {
		display: block;
	}

	 
	.mobile-menu-button {
		display: block;
		position: fixed !important;
		top: 10px !important;
		right: 10px !important;
		z-index: 1001;
		background: var(--vivid4);
		color: white;
		border: none;
		padding: 10px 15px;
		border-radius: 4px;
		font-size: 16px;
		cursor: pointer;
		transform: translateZ(0);  
		-webkit-transform: translateZ(0);
		will-change: transform;
	}

	main {
		max-width: 100%;
		padding: 50px 0 0 0;  
		margin-left: 0;
	}

	h1 {
		font-size: 24px;
		padding: 5px 0;
		flex-wrap: wrap;
	}

	h2 {
		font-size: 20px;
		margin-top: 20px;
	}

	 
	.example-container {
		margin: var(--gap-large) 0;
	}

	.grid-container {
		gap: var(--gap-small);
	}

	 
	bkl-code {
		font-size: 14px;
		padding: var(--padding-code);
		max-width: calc(100vw - 40px);
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
	}

	 
	.operator-symbol {
		font-size: var(--operator-size);
		margin: 10px 0;
	}

	.operator-with-label {
		padding-top: 0;
	}


	 
	label {
		font-size: 14px;
		padding: var(--padding-label);
	}

	 
	table {
		font-size: 14px;
		display: block;
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
		width: max-content;
		max-width: 100%;
	}

	th, td {
		padding: 8px;
		min-width: 100px;
	}

	 
	code {
		font-size: 14px;
		padding: 2px 4px;
	}

	 
	ol, ul {
		padding-left: 20px;
	}

	 
	#searchBar {
		font-size: 16px;  
		width: calc(100% - 20px);
		max-width: 250px;
		padding: 10px;
	}

	 
	.code-container {
		position: relative;
	}

	.code-container::after {
		content: '';
		position: absolute;
		right: 0;
		top: 0;
		bottom: 0;
		width: 20px;
		background: linear-gradient(to right, transparent, rgba(0,0,0,0.1));
		pointer-events: none;
		opacity: 0;
		transition: opacity 0.3s;
	}

	.code-container:has(bkl-code::-webkit-scrollbar-thumb)::after {
		opacity: 1;
	}
}

 
@media (max-width: 480px) {
	:root {
		--padding-code: 8px;
		--padding-label: 4px 8px;
		--gap-small: 8px;
		--gap-large: 12px;
		--operator-size: 20px;
	}

	h1 {
		font-size: 20px;
	}

	h2 {
		font-size: 18px;
	}

	bkl-code {
		font-size: 12px;
	}

	label {
		font-size: 12px;
	}
}

 
@media (min-width: 769px) {
	.mobile-menu-button {
		display: none;
	}

	nav {
		display: flex !important;
		flex-direction: column;
		position: fixed;
		left: 20px;
		top: 20px;
		bottom: 20px;
		width: 200px;
		height: auto;
		padding: 0;
		margin-right: 0;
		background: transparent;
	}

	#searchBar {
		max-width: 180px;
	}
}
</style>
</head>
<body>

<button class="mobile-menu-button" onclick="toggleMobileMenu()">☰ Nav</button>

<nav>
<input type="text" id="searchBar" placeholder="Search" style="width: 100%; padding: 8px; box-sizing: border-box;">
<div class="nav-scroll-container">
<ol>

	<li><a href="#intro">K8s migration</a></li>

	<li><a href="#original">Original files</a></li>

	<li><a href="#pre-prep">Create prep dir</a></li>

	<li><a href="#prep">Prep</a></li>

	<li><a href="#prep-validate">Validate</a></li>

	<li><a href="#plan">Target layout</a></li>

	<li><a href="#namespace">namespace</a></li>

	<li><a href="#base">base</a></li>

	<li><a href="#api-service">api-service</a></li>

	<li><a href="#web-service">web-service</a></li>

	<li><a href="#convert-validate">Validate</a></li>

	<li><a href="#polish">Polish</a></li>

	<li><a href="#polish-validate">Validate</a></li>

</ol>
</div>
</nav>

<main>


<section id="intro">
<h2><a name="intro">K8s migration</a></h2>



<p>This example shows conversion of a realistic Kubernetes config to bkl. We'll use bkl best practices and explain the reasoning behind each choice.
</p>



</section>

<section id="original">
<h2><a name="original">Original files</a></h2>



<p><p>We start with a list of config files like this:</p>

<pre>
original/
  dev/
    namespace.yaml
    api-service.yaml
    web-service.yaml
  prod/
    namespace.yaml
    api-service.yaml
    web-service.yaml
  staging/
    namespace.yaml
    api-service.yaml
    web-service.yaml
</pre>
</p>



</section>

<section id="pre-prep">
<h2><a name="pre-prep">Create prep dir</a></h2>



<p><p>Make a copy of your original configs into a prep directory for editing and comparison.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <command></prompt>cp</command> <flag>-r</flag> <argument>original</argument> <argument>prep</argument></bkl-code>
</div>

</div>




</section>

<section id="prep">
<h2><a name="prep">Prep</a></h2>



<p><p>Transform patterns in the prep configs using bkl features to make them easier to work with.</p>
</p>



<p><p>Convert lists of items to maps with names plus <highlight>$encode: values</highlight>. This allows them to be easily referenced by upper layers. Use keys that make sense for the values, but remember that they must be valid YAML.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>ports</key>:
  - <key>port</key>: <number>80</number>
    <key>protocol</key>: <string>TCP</string>
  - <key>port</key>: <number>443</number>
    <key>protocol</key>: <string>TCP</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>ports</key>:
  <highlight><key>http</key>:</highlight>
    <key>port</key>: <number>80</number>
    <key>protocol</key>: <string>TCP</string>
  <highlight><key>https</key>:</highlight>
    <key>port</key>: <number>443</number>
    <key>protocol</key>: <string>TCP</string>
  <highlight><key>$encode</key>: <string>values</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>When the list items need to contain the key (e.g. <highlight>ports: { name: http }</highlight>), we can use <highlight>$encode: values:name</highlight> to reduce duplication.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>ports</key>:
  - <highlight><key>name</key>: <string>http</string></highlight>
    <key>port</key>: <number>80</number>
    <key>protocol</key>: <string>TCP</string>
  - <highlight><highlight><key>name</key>: <string>http</highlight>s</string></highlight>
    <key>port</key>: <number>443</number>
    <key>protocol</key>: <string>TCP</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>ports</key>:
  <highlight><key>http</key>:</highlight>
    <key>port</key>: <number>80</number>
    <key>protocol</key>: <string>TCP</string>
  <highlight><key>https</key>:</highlight>
    <key>port</key>: <number>443</number>
    <key>protocol</key>: <string>TCP</string>
  <highlight><key>$encode</key>: <string>values:name</string></highlight></bkl-code>
</div>



</div>
</div>
</div>















<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled">- <key>resource</key>:
    <key>name</key>: <string>cpu</string>
    <key>target</key>:
      <key>averageUtilization</key>: <number>70</number>
      <key>type</key>: <string>Utilization</string>
  <key>type</key>: <string>Resource</string>
- <key>resource</key>:
    <key>name</key>: <string>memory</string>
    <key>target</key>:
      <key>averageUtilization</key>: <number>80</number>
      <key>type</key>: <string>Utilization</string>
  <key>type</key>: <string>Resource</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>cpu</key>:
  <key>resource</key>:
    <key>target</key>:
      <key>averageUtilization</key>: <number>70</number>
      <key>type</key>: <string>Utilization</string>
  <key>type</key>: <string>Resource</string>
<key>memory</key>:
  <key>resource</key>:
    <key>target</key>:
      <key>averageUtilization</key>: <number>80</number>
      <key>type</key>: <string>Utilization</string>
  <key>type</key>: <string>Resource</string>
<highlight><key>$encode</key>: <string>values:resource.name</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>Convert environment variable lists to maps for easier overriding and use <highlight>$encode: values:name:value</highlight> to transform them back.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>env</key>:
  - <key>name</key>: <string>DB_HOST</string>
    <key>value</key>: <string>postgres</string>
  - <key>name</key>: <string>DB_PORT</string>
    <key>value</key>: <string>"5432"</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>env</key>:
  <key>DB_HOST</key>: <string>postgres</string>
  <key>DB_PORT</key>: <string>"5432"</string>
  <highlight><key>$encode</key>: <string>values:name:value</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>Lists with <highlight>valueFrom</highlight> use <highlight>$encode: values:name</highlight> instead.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>env</key>:
  - <key>name</key>: <string>ANALYTICS_KEY</string>
    <key>valueFrom</key>:
      <key>secretKeyRef</key>:
        <key>key</key>: <string>analytics-key</string>
        <key>name</key>: <string>web-secrets</string>
  - <key>name</key>: <string>API_URL</string>
    <key>value</key>: <string>https://api.example.com</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>env</key>:
  <key>ANALYTICS_KEY</key>:
    <key>valueFrom</key>:
      <key>secretKeyRef</key>:
        <key>key</key>: <string>analytics-key</string>
        <key>name</key>: <string>web-secrets</string>
  <key>API_URL</key>:
    <key>value</key>: <string>https://api.example.com</string>
  <highlight><key>$encode</key>: <string>values:name</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>Convert argument lists to maps with names plus <highlight>$encode: flags</highlight>. If there are non-flag initial arguments, move them from <highlight>args</highlight> to <highlight>command</highlight>. Values are converted to strings automatically, so you don't need to quote them.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>args</key>:
  - <string>--config=/app/config/app.properties</string>
  - <string>--feature=auth</string>
  - <string>--feature=metrics</string>
  - <string>--feature=rate-limiting</string>
  - <string>--log-format=json</string>
  - <string>--log-level=2</string>
  - <string>--verbose</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>args</key>:
  <key>config</key>: <string>/app/config/app.properties</string>
  <key>feature</key>:
    - <string>auth</string>
    - <string>metrics</string>
    - <string>rate-limiting</string>
  <key>log-format</key>: <string>json</string>
  <key>log-level</key>: <number>2</number>
  <key>verbose</key>: <string>""</string>
  <highlight><key>$encode</key>: <string>flags</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>Convert embedded JSON/YAML strings to structures with <highlight>$encode: json-pretty</highlight> or <highlight>$encode: yaml</highlight>.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>app.config.json</key>: <string>|</string>
  <string>{</string>
    <string><string>"apiUrl"</string>: "http://api-service",</string>
    <string><string>"debugMode"</string>: true,</string>
    <string><string>"environment"</string>: "development",</string>
    <string><string>"features"</string>: {</string>
      <string><string>"analytics"</string>: false,</string>
      <string><string>"caching"</string>: false</string>
    <string>}</string>
  <string>}</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>app.config.json</key>:
  <key>apiUrl</key>: <string>http://api-service</string>
  <key>debugMode</key>: <bool>true</bool>
  <key>environment</key>: <string>development</string>
  <key>features</key>:
    <key>analytics</key>: <bool>false</bool>
    <key>caching</key>: <bool>false</bool>
  <highlight><key>$encode</key>: <string>json-pretty</string></highlight></bkl-code>
</div>



</div>
</div>
</div>















<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>prometheus.yml</key>: <string>|</string>
  <key>global</key>:
    <key>evaluation_interval</key>: <string>15s</string>
    <key>scrape_interval</key>: <string>15s</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>prometheus.yml</key>:
  <key>global</key>:
    <key>evaluation_interval</key>: <string>15s</string>
    <key>scrape_interval</key>: <string>15s</string>
  <highlight><key>$encode</key>: <string>yaml</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>For Java-style properties files, use <highlight>$encode: properties</highlight>.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>app.properties</key>: <string>|</string>
  <string>cache.ttl=3600</string>
  <string>environment=production</string>
  <string>logging.format=json</string>
  <string>logging.level=warn</string>
  <string>logging.output=stdout</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>app.properties</key>:
  <key>cache.ttl</key>: <number>3600</number>
  <key>environment</key>: <string>production</string>
  <key>logging.format</key>: <string>json</string>
  <key>logging.level</key>: <string>warn</string>
  <key>logging.output</key>: <string>stdout</string>
  <highlight><key>$encode</key>: <string>properties</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>Convert embedded base64 strings to <highlight>$encode: base64</highlight>.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>database-url</key>: <string>cG9zdGdyZXNxbDovL3Byb2R1c2VyOnByb2RwYXNzQHByb2QtZGItY2x1c3Rlci5yZHMuYW1hem9uYXdzLmNvbTo1NDMyL3Byb2RkYg==</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>database-url</key>:
  <key>$value</key>: <string>postgresql://produser:prodpass@prod-db-cluster.rds.amazonaws.com:5432/proddb</string>
  <highlight><key>$encode</key>: <string>base64</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






<p><p>Remove duplication between string fields with <highlight>$""</highlight>.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>labels</key>:
  <key>environment</key>: <string>prod</string>
<key>namespace</key>: <string>api-prod</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>labels</key>:
  <key>environment</key>: <string>prod</string>
<key>namespace</key>: <highlight><string>$"api-{labels.environment}"</string></highlight></bkl-code>
</div>



</div>
</div>
</div>






</section>

<section id="prep-validate">
<h2><a name="prep-validate">Validate</a></h2>



<p><p>Validate the prepped files against the original configs before continuing.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/namespace.yaml</argument> <argument>prep/prod/namespace.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/api-service.yaml</argument> <argument>prep/prod/api-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/web-service.yaml</argument> <argument>prep/prod/web-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/namespace.yaml</argument> <argument>prep/staging/namespace.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/api-service.yaml</argument> <argument>prep/staging/api-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/web-service.yaml</argument> <argument>prep/staging/web-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/namespace.yaml</argument> <argument>prep/dev/namespace.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/api-service.yaml</argument> <argument>prep/dev/api-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/web-service.yaml</argument> <argument>prep/dev/web-service.yaml</argument></bkl-code>
</div>

</div>




</section>

<section id="plan">
<h2><a name="plan">Target layout</a></h2>



<p><p>Plan a file/layer structure for the bkl configs (since bkl uses filenames to determine layer structure).</p>

<p>Keep the original <highlight>namespace</highlight>/<highlight>api-service</highlight>/<highlight>web-service</highlight> structure to match the existing user expectations.</p>

<p>The <highlight>namespace</highlight> configs are small and self-contained; keep those independent. Compare the <highlight>api-service</highlight> and <highlight>web-service</highlight> configs to see if they should have a common base layer.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <command></prompt>bkli</command> <flag>--selector=kind</flag> <argument>prep/prod/api-service.yaml</argument> <argument>prep/prod/web-service.yaml</argument></bkl-code>
</div>

</div>




<p><p>The configs are similar enough to have a common base layer. Use the following bkl config structure:</p>

<pre>
namespace.yaml
  namespace.staging.yaml
    namespace.staging.dev.yaml
base.yaml
  base.api-service.yaml
    base.api-service.staging.yaml
      base.api-service.staging.dev.yaml
  base.web-service.yaml
    base.web-service.staging.yaml
      base.web-service.staging.dev.yaml
</pre>

<p>Use the production version of each config as the base layer. This means that all other environments are expressed as differences from production, encouraging minimizing those differences.</p>

<p>Create a directory to put these in.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <command></prompt>mkdir</command> <flag>-p</flag> <argument>bkl</argument></bkl-code>
</div>

</div>




</section>

<section id="namespace">
<h2><a name="namespace">namespace</a></h2>



<p><p>Use <highlight>bkl</highlight> to sort keys in plain YAML files. Use <highlight>bkld</highlight> to produce a diff of two plain YAML or bkl files.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bkl</command> <argument>prep/prod/namespace.yaml</argument> <flag>--output=bkl/namespace.yaml</flag>
<prompt>$ <command></prompt>bkld</command> <flag>--selector=kind</flag> <argument>bkl/namespace.yaml</argument> <argument>prep/staging/namespace.yaml</argument> <flag>--output=bkl/namespace.staging.yaml</flag>
<prompt>$ </prompt><command>bkld</command> <flag>--selector=kind</flag> <argument>bkl/namespace.yaml</argument> <argument>prep/dev/namespace.yaml</argument> <flag>--output=bkl/namespace.staging.dev.yaml</flag></bkl-code>
</div>

</div>




</section>

<section id="base">
<h2><a name="base">base</a></h2>



<p><p>Use <highlight>bkli</highlight> to create a minimal base layer for the services.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <command></prompt>bkli</command> <flag>--selector=kind</flag> <argument>prep/prod/api-service.yaml</argument> <argument>prep/prod/web-service.yaml</argument> <flag>--output=bkl/base.yaml</flag></bkl-code>
</div>

</div>




</section>

<section id="api-service">
<h2><a name="api-service">api-service</a></h2>



<p><p>Use <highlight>bkld</highlight> to produce a diff of two plain YAML or bkl files.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bkld</command> <flag>--selector=kind</flag> <argument>bkl/base.yaml</argument> <argument>prep/prod/api-service.yaml</argument> <flag>--output=bkl/base.api-service.yaml</flag>
<prompt>$ </prompt><command>bkld</command> <flag>--selector=kind</flag> <argument>bkl/base.api-service.yaml</argument> <argument>prep/staging/api-service.yaml</argument> <flag>--output=bkl/base.api-service.staging.yaml</flag>
<prompt>$ </prompt><command>bkld</command> <flag>--selector=kind</flag> <argument>bkl/base.api-service.staging.yaml</argument> <argument>prep/dev/api-service.yaml</argument> <flag>--output=bkl/base.api-service.staging.dev.yaml</flag></bkl-code>
</div>

</div>




</section>

<section id="web-service">
<h2><a name="web-service">web-service</a></h2>



<p><p>Use <highlight>bkld</highlight> to produce a diff of two plain YAML or bkl files.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bkld</command> <flag>--selector=kind</flag> <argument>bkl/base.yaml</argument> <argument>prep/prod/web-service.yaml</argument> <flag>--output=bkl/base.web-service.yaml</flag>
<prompt>$ </prompt><command>bkld</command> <flag>--selector=kind</flag> <argument>bkl/base.web-service.yaml</argument> <argument>prep/staging/web-service.yaml</argument> <flag>--output=bkl/base.web-service.staging.yaml</flag>
<prompt>$ </prompt><command>bkld</command> <flag>--selector=kind</flag> <argument>bkl/base.web-service.staging.yaml</argument> <argument>prep/dev/web-service.yaml</argument> <flag>--output=bkl/base.web-service.staging.dev.yaml</flag></bkl-code>
</div>

</div>




</section>

<section id="convert-validate">
<h2><a name="convert-validate">Validate</a></h2>



<p><p>Validate the bkl file layers against the original configs.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/namespace.yaml</argument> <argument>bkl/namespace.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/namespace.yaml</argument> <argument>bkl/namespace.staging.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/namespace.yaml</argument> <argument>bkl/namespace.staging.dev.yaml</argument>

<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/api-service.yaml</argument> <argument>bkl/base.api-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/api-service.yaml</argument> <argument>bkl/base.api-service.staging.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/api-service.yaml</argument> <argument>bkl/base.api-service.staging.dev.yaml</argument>

<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/web-service.yaml</argument> <argument>bkl/base.web-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/web-service.yaml</argument> <argument>bkl/base.web-service.staging.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/web-service.yaml</argument> <argument>bkl/base.web-service.staging.dev.yaml</argument></bkl-code>
</div>

</div>




</section>

<section id="polish">
<h2><a name="polish">Polish</a></h2>



<p><p>Apply additional simplifications to the bkl configs.</p>
</p>



<p><p>Merge together common overrides into a single document. When merging things like labels, you may find cases where the values weren't consistently applied before to all objects, but could be.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>environment</key>: <string>prod</string>
<string>---</string>
<key>kind</key>: <string>Deployment</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>environment</key>: <string>prod</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>kind</key>: <string>Service</string>
<string>---</string>
<key>kind</key>: <string>Deployment</string>
<string>---</string>
<key>$match</key>: <string>{}</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>environment</key>: <string>prod</string></bkl-code>
</div>



</div>
</div>
</div>






<p><p>If overrides must only apply to a subset of objects, use <highlight>$matches</highlight> to select them.</p>
</p>












<div class="example-container">
<div class="grid-container grid-3-col">

<div class="code-container">

<bkl-code class="code-unlabeled"><key>kind</key>: <string>Ingress</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>app</key>: <string>frontend</string>
<string>---</string>
<key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>app</key>: <string>frontend</string>
<string>---</string>
<key>kind</key>: <string>Secret</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>app</key>: <string>backend</string></bkl-code>
</div>


<div class="operator-symbol">→</div>

<div class="code-container" style="display: contents;">





<div class="code-container">

<bkl-code class="code-unlabeled"><key>kind</key>: <string>Ingress</string>
<string>---</string>
<key>kind</key>: <string>Service</string>
<string>---</string>
<key>kind</key>: <string>Secret</string>
<string>---</string>
<key>$matches</key>:
  - <key>kind</key>: <string>Ingress</string>
  - <key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>app</key>: <string>frontend</string>
<string>---</string>
<key>$matches</key>:
  - <key>kind</key>: <string>Secret</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>app</key>: <string>backend</string></bkl-code>
</div>



</div>
</div>
</div>






</section>

<section id="polish-validate">
<h2><a name="polish-validate">Validate</a></h2>



<p><p>Validate the polished bkl file layers against the original configs.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/namespace.yaml</argument> <argument>bkl/namespace.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/namespace.yaml</argument> <argument>bkl/namespace.staging.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/namespace.yaml</argument> <argument>bkl/namespace.staging.dev.yaml</argument>

<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/api-service.yaml</argument> <argument>bkl/base.api-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/api-service.yaml</argument> <argument>bkl/base.api-service.staging.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/api-service.yaml</argument> <argument>bkl/base.api-service.staging.dev.yaml</argument>

<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/prod/web-service.yaml</argument> <argument>bkl/base.web-service.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/staging/web-service.yaml</argument> <argument>bkl/base.web-service.staging.yaml</argument>
<prompt>$ </prompt><command>bklc</command> <flag>--sort=kind</flag> <flag>--color</flag> <argument>original/dev/web-service.yaml</argument> <argument>bkl/base.web-service.staging.dev.yaml</argument></bkl-code>
</div>

</div>




</section>


</main>

<script>

function toggleMobileMenu() {
    const nav = document.querySelector('nav');
    const button = document.querySelector('.mobile-menu-button');
    nav.classList.toggle('mobile-open');
    button.textContent = nav.classList.contains('mobile-open') ? '✕ Close' : '☰ Nav';
}


function toggleExpand(button) {
    const wrapper = button.closest('.code-wrapper');
    const codeBlock = wrapper.querySelector('bkl-code');
    const isCollapsed = codeBlock.classList.contains('collapsed');
    
    if (isCollapsed) {
        codeBlock.classList.remove('collapsed');
        button.textContent = '∨';
        button.setAttribute('aria-expanded', 'true');
    } else {
        codeBlock.classList.add('collapsed');
        button.textContent = '›';
        button.setAttribute('aria-expanded', 'false');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const searchBar = document.getElementById('searchBar');
    const sections = Array.from(document.querySelectorAll('main > section'));
    const navList = document.querySelector('nav ol');
    const navItems = Array.from(navList.querySelectorAll('li'));
    
    
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            const nav = document.querySelector('nav');
            const button = document.querySelector('.mobile-menu-button');
            if (nav.classList.contains('mobile-open')) {
                nav.classList.remove('mobile-open');
                button.textContent = '☰ Nav';
            }
        });
    });
    
    const originalOrder = sections.map((section, index) => ({
        element: section,
        navItem: navItems[index],
        id: section.id,
        title: section.querySelector('h2').textContent.toLowerCase(),
        content: section.textContent.toLowerCase()
    }));

    searchBar.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();
        
        if (!query) {
            const main = document.querySelector('main');
            originalOrder.forEach(item => {
                main.appendChild(item.element);
                navList.appendChild(item.navItem);
            });
            window.scrollTo(0, 0);
            return;
        }

        const scored = originalOrder.map(item => {
            let score = 0;
            const keywords = query.split(/\s+/);
            
            keywords.forEach(keyword => {
                if (item.title.includes(keyword)) {
                    score += 5;
                }
                let index = 0;
                let matches = 0;
                while ((index = item.content.indexOf(keyword, index)) !== -1) {
                    matches++;
                    index += keyword.length;
                }
                score += matches;
            });
            
            return { ...item, score };
        });

        const main = document.querySelector('main');
        scored.sort((a, b) => b.score - a.score);
        
        scored.forEach(item => {
            main.appendChild(item.element);
            navList.appendChild(item.navItem);
        });
        
        window.scrollTo(0, 0);
    });
});
</script>

</body>
</html>















<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bkl - Layered Configuration Language</title>
<link rel="icon" href="icon.png">
<style>
:root {
	--vivid0: hsl(6deg 96% 26%);
	--vivid1: hsl(8deg 92% 35%);
	--vivid2: hsl(10deg 93% 40%);
	--vivid3: hsl(12deg 86% 47%);
	--vivid4: hsl(14deg 89% 55%);
	--vivid5: hsl(16deg 94% 61%);
	--vivid6: hsl(18deg 100% 70%);
	--vivid7: hsl(20deg 100% 77%);
	--vivid8: hsl(22deg 100% 85%);
	--vivid9: hsl(24deg 100% 93%);
	--neutral0: hsl(210deg 24% 16%);
	--neutral1: hsl(209deg 20% 25%);
	--neutral2: hsl(209deg 18% 30%);
	--neutral3: hsl(209deg 14% 37%);
	--neutral4: hsl(211deg 12% 43%);
	--neutral5: hsl(211deg 10% 53%);
	--neutral6: hsl(211deg 13% 65%);
	--neutral7: hsl(210deg 16% 82%);
	--neutral8: hsl(214deg 15% 91%);
	--neutral9: hsl(216deg 33% 97%);
	--blue0: hsl(234deg 62% 26%);
	--blue1: hsl(232deg 51% 36%);
	--blue2: hsl(230deg 49% 41%);
	--blue3: hsl(228deg 45% 45%);
	--blue4: hsl(227deg 42% 51%);
	--blue5: hsl(227deg 50% 59%);
	--blue6: hsl(225deg 57% 67%);
	--blue7: hsl(224deg 67% 76%);
	--blue8: hsl(221deg 78% 86%);
	--blue9: hsl(221deg 68% 93%);
	--red0: hsl(360deg 92% 20%);
	--red1: hsl(360deg 85% 25%);
	--red2: hsl(360deg 79% 32%);
	--red3: hsl(360deg 72% 38%);
	--red4: hsl(360deg 67% 44%);
	--red5: hsl(360deg 64% 55%);
	--red6: hsl(360deg 71% 66%);
	--red7: hsl(360deg 77% 78%);
	--red8: hsl(360deg 82% 89%);
	--red9: hsl(360deg 100% 97%);
	--yellow0: hsl(43deg 86% 17%);
	--yellow1: hsl(43deg 77% 27%);
	--yellow2: hsl(43deg 72% 37%);
	--yellow3: hsl(42deg 63% 48%);
	--yellow4: hsl(42deg 78% 60%);
	--yellow5: hsl(43deg 89% 70%);
	--yellow6: hsl(43deg 90% 76%);
	--yellow7: hsl(45deg 86% 81%);
	--yellow8: hsl(45deg 90% 88%);
	--yellow9: hsl(45deg 100% 96%);
	--green0: hsl(125deg 86% 14%);
	--green1: hsl(125deg 73% 20%);
	--green2: hsl(125deg 56% 29%);
	--green3: hsl(122deg 47% 35%);
	--green4: hsl(122deg 39% 41%);
	--green5: hsl(123deg 35% 51%);
	--green6: hsl(123deg 38% 63%);
	--green7: hsl(122deg 42% 75%);
	--green8: hsl(126deg 49% 84%);
	--green9: hsl(125deg 65% 93%);
	
	 
	--gap-small: 15px;
	--gap-large: 20px;
	--padding-code: 15px;
	--padding-label: 6px 15px 4px 15px;
	--border-radius: 5px;
	--border-radius-label: 0 5px 5px 5px;
	--operator-size: 30px;
	--operator-padding-top: 27px;
}

@font-face {
	font-family: "komet";
	src: url("komet.woff2");
}

@font-face {
	font-family: "source-code-pro";
	src: url("source-code-pro.woff2");
}

body {
	align-items: stretch;
	background-color: var(--neutral9);
	color: var(--neutral1);
	display: flex;
	font-family: "komet";
	font-size: 17px;
	gap: 50px;
	justify-content: center;
	line-height: 1.4;
	margin: 0;
	min-height: 100vh;
	padding: 20px;
}

nav {
	position: fixed;
	left: 20px;
	top: 20px;
	bottom: 20px;
	width: 200px;
	display: flex;
	flex-direction: column;
}

nav {
	position: relative;
}

nav .nav-scroll-container {
	overflow-y: auto;
	flex: 1;
	margin-top: 10px;
}


nav ol {
	list-style: none;
	margin: 0;
	padding: 0;
}

li {
	padding-bottom: 10px;
}

nav a {
	color: var(--neutral5);
	text-decoration: none;
	font-family: source-code-pro;
}

nav a:hover {
	color: var(--neutral3);
}

main {
	max-width: min(750px, 100vw - 20px);
	margin-left: 250px;
}

h1, h2 {
	margin-bottom: 5px;
	margin-top: 30px;
}

h1 {
	align-items: center;
	color: var(--vivid4);
	display: flex;
	font-size: 30px;
	gap: 10px;
	margin: 0;
	padding: 10px 0 10px 0;
	position: relative;
}

h2 {
	color: var(--vivid2);
	font-family: source-code-pro;
	font-size: 25px;
}

h2 a {
	color: inherit;
	text-decoration: none;
}

p {
	hyphens: auto;
	margin: 0 0 10px 0;
}

a {
	color: var(--blue3);
}

label {
	background: var(--neutral2);
	border-radius: var(--border-radius) var(--border-radius) 0 0;
	color: var(--neutral8);
	font-family: source-code-pro;
	display: block;
	padding: var(--padding-label);
	width: fit-content;
}

label.invisible {
	background: transparent;
	color: transparent;
}

bkl-code {
	color: var(--neutral7);
	background: var(--neutral0);
	border-radius: var(--border-radius);
	display: block;
	font-family: source-code-pro;
	font-size: 16px;
	height: fit-content;
	hyphens: none;
	line-height: 1.5;
	overflow-x: auto;
	overflow-y: auto;
	padding: var(--padding-code);
	tab-size: 4;
	text-align: left;
	white-space: pre;
	width: 100%;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	box-sizing: border-box;
	max-width: 100%;
	min-width: 0;
}



 
label:not(.invisible) + bkl-code {
	border-top-left-radius: 0 !important;
}

 
label.invisible + bkl-code {
	border-top-left-radius: 4px !important;
}

bkl-code + p,
div:has(> bkl-code) + p {
	margin-top: 10px;
}

row {
	display: block;
	max-width: 100%;
	overflow: hidden;
}


op {
	align-items: center;
	display: flex;
	font-size: 30px;
	justify-content: center;
	line-height: 0.5;
	text-align: center;
	white-space: pre;
}

 
.code-container {
	display: flex;
	flex-direction: column;
	min-width: 0;
	overflow: hidden;
}

.example-container {
	display: flex;
	flex-direction: column;
	gap: var(--gap-small);
	margin: var(--gap-large) 0;
}

.grid-container {
	display: grid;
	align-items: stretch;
	column-gap: var(--gap-small);
	max-width: 100%;
	overflow: hidden;
}

.grid-2-col {
	grid-template-columns: 1fr 1fr;
}

.grid-3-col {
	grid-template-columns: 1fr auto 1fr;
}

.grid-5-col {
	grid-template-columns: 1fr auto 1fr auto 1fr;
}

.operator-symbol {
	align-items: center;
	display: flex;
	font-size: var(--operator-size);
	justify-content: center;
	line-height: 0.5;
	text-align: center;
	white-space: pre;
}

.operator-with-label {
	padding-top: var(--operator-padding-top);
}

.code-labeled {
	margin-top: 0;
	flex-grow: 1;
	border-radius: var(--border-radius-label);
	border-top-left-radius: 0;
}

.code-unlabeled {
	flex-grow: 1;
	height: 100%;
}

.label-container {
	display: flex;
	flex-direction: column;
	flex-shrink: 0;
}

.label-spacing {
	margin-bottom: 0;
}

.error-display {
	display: flex;
	align-items: center;
	justify-content: center;
	height: 100%;
	font-size: 24px;
	font-weight: bold;
}

 
.code-wrapper {
	position: relative;
}

.expand-toggle {
	position: absolute;
	top: 10px;
	right: 10px;
	z-index: 10;
	background: var(--blue4);
	color: var(--neutral9);
	border: 1px solid var(--blue3);
	border-radius: 3px;
	padding: 2px 8px;
	font-size: 14px;
	cursor: pointer;
	font-family: source-code-pro;
	transition: background-color 0.2s;
}

.expand-toggle:hover {
	background: var(--blue3);
}

bkl-code.collapsed {
	max-height: 90px;
	overflow: hidden;
	position: relative;
}

bkl-code.collapsed::after {
	content: '';
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: 40px;
	background: linear-gradient(to bottom, transparent, var(--neutral0));
	pointer-events: none;
}

key {
	color: var(--yellow4);
}

prompt {
	user-select: none;
	-webkit-user-select: none;
	color: var(--neutral5);
}

cmd {
	color: var(--blue5);
}

command {
	color: var(--blue5);
	font-weight: 500;
}

builtin {
	color: var(--blue5);
	font-weight: 500;
}

operator {
	color: var(--vivid5);
	font-weight: 600;
}

argument {
	color: var(--neutral8);
}

variable {
	color: var(--green5);
}

string {
	color: var(--green6);
}

number {
	color: var(--green6);
}

bool {
	color: var(--green6);
}

flag {
	color: var(--vivid3);
}

comment {
	color: var(--neutral5);
	font-style: italic;
}

keyword {
	color: var(--red5);
}

escape {
	color: var(--vivid3);
	font-weight: 600;
}

 
bkl-code highlight,
bkl-code highlight > * {
	color: var(--red6);
	background: transparent;
}

 
p highlight {
	background: var(--neutral8);
	color: var(--red6);
	display: inline-block;
	font-family: source-code-pro;
	font-size: 15px;
	padding: 0 3px 0 3px;
	white-space: nowrap;
}

p highlight * {
	color: var(--red6) !important;
}

 
addition {
	color: var(--green5);
}

deletion {
	color: var(--red5);
}

file-header {
	color: var(--blue5);
	font-weight: 500;
}

hunk-header {
	color: var(--vivid5);
	font-weight: 500;
}

 
.mobile-menu-button {
	display: none;
}

 
@media (max-width: 768px) {
	 
	:root {
		--padding-code: 10px;
		--padding-label: 5px 10px;
		--gap-small: 10px;
		--gap-large: 15px;
		--operator-size: 24px;
	}

	 
	body {
		padding: 10px;
		display: block;
	}

	nav {
		display: none;  
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: white;
		z-index: 1000;
		padding: 20px;
		overflow-y: auto;
	}

	nav.mobile-open {
		display: block;
	}

	 
	.mobile-menu-button {
		display: block;
		position: fixed !important;
		top: 10px !important;
		right: 10px !important;
		z-index: 1001;
		background: var(--vivid4);
		color: white;
		border: none;
		padding: 10px 15px;
		border-radius: 4px;
		font-size: 16px;
		cursor: pointer;
		transform: translateZ(0);  
		-webkit-transform: translateZ(0);
		will-change: transform;
	}

	main {
		max-width: 100%;
		padding: 50px 0 0 0;  
		margin-left: 0;
	}

	h1 {
		font-size: 24px;
		padding: 5px 0;
		flex-wrap: wrap;
	}

	h2 {
		font-size: 20px;
		margin-top: 20px;
	}

	 
	.example-container {
		margin: var(--gap-large) 0;
	}

	.grid-container {
		gap: var(--gap-small);
	}

	 
	bkl-code {
		font-size: 14px;
		padding: var(--padding-code);
		max-width: calc(100vw - 40px);
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
	}

	 
	.operator-symbol {
		font-size: var(--operator-size);
		margin: 10px 0;
	}

	.operator-with-label {
		padding-top: 0;
	}


	 
	label {
		font-size: 14px;
		padding: var(--padding-label);
	}

	 
	table {
		font-size: 14px;
		display: block;
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
		width: max-content;
		max-width: 100%;
	}

	th, td {
		padding: 8px;
		min-width: 100px;
	}

	 
	code {
		font-size: 14px;
		padding: 2px 4px;
	}

	 
	ol, ul {
		padding-left: 20px;
	}

	 
	#searchBar {
		font-size: 16px;  
		width: calc(100% - 20px);
		max-width: 250px;
		padding: 10px;
	}

	 
	.code-container {
		position: relative;
	}

	.code-container::after {
		content: '';
		position: absolute;
		right: 0;
		top: 0;
		bottom: 0;
		width: 20px;
		background: linear-gradient(to right, transparent, rgba(0,0,0,0.1));
		pointer-events: none;
		opacity: 0;
		transition: opacity 0.3s;
	}

	.code-container:has(bkl-code::-webkit-scrollbar-thumb)::after {
		opacity: 1;
	}
}

 
@media (max-width: 480px) {
	:root {
		--padding-code: 8px;
		--padding-label: 4px 8px;
		--gap-small: 8px;
		--gap-large: 12px;
		--operator-size: 20px;
	}

	h1 {
		font-size: 20px;
	}

	h2 {
		font-size: 18px;
	}

	bkl-code {
		font-size: 12px;
	}

	label {
		font-size: 12px;
	}
}

 
@media (min-width: 769px) {
	.mobile-menu-button {
		display: none;
	}

	nav {
		display: flex !important;
		flex-direction: column;
		position: fixed;
		left: 20px;
		top: 20px;
		bottom: 20px;
		width: 200px;
		height: auto;
		padding: 0;
		margin-right: 0;
		background: transparent;
	}

	#searchBar {
		max-width: 180px;
	}
}
</style>
</head>
<body>

<button class="mobile-menu-button" onclick="toggleMobileMenu()">☰ Nav</button>

<nav>
<input type="text" id="searchBar" placeholder="Search" style="width: 100%; padding: 8px; box-sizing: border-box;">
<div class="nav-scroll-container">
<ol>

	<li><a href="#intro">K8s migration</a></li>

	<li><a href="#original">Original config</a></li>

	<li><a href="#namespace">namespace</a></li>

	<li><a href="#api-service">api-service</a></li>

</ol>
</div>
</nav>

<main>


<section id="intro">
<h2><a name="intro">K8s migration</a></h2>



<p>This example shows conversion of a realistic Kubernetes config to bkl. We'll use bkl best practices and explain the reasoning behind each choice.
</p>



</section>

<section id="original">
<h2><a name="original">Original config</a></h2>




<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">dev/namespace.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Namespace</string>
<key>metadata</key>:
  <key>name</key>: <string>microservices-dev</string>
  <key>labels</key>:
    <key>environment</key>: <string>dev</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">dev/api-service.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ConfigMap</string>
<key>metadata</key>:
  <key>name</key>: <string>api-config</string>
  <key>namespace</key>: <string>microservices-dev</string>
<key>data</key>:
  <key>app.properties</key>: <string>|</string>
    <string>server.port=8080</string>
    <string>server.name=api-service</string>
    <string>logging.level=debug</string>
    <string>logging.format=json</string>
    <string>cache.enabled=false</string>
    <string>cache.ttl=300</string>
    <string>database.pool_size=5</string>
    <string>database.timeout=30</string>
    <string>environment=development</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Secret</string>
<key>metadata</key>:
  <key>name</key>: <string>api-secrets</string>
  <key>namespace</key>: <string>microservices-dev</string>
<key>type</key>: <string>Opaque</string>
<key>data</key>:
  <key>database-url</key>: <string>cG9zdGdyZXNxbDovL2RldnVzZXI6ZGV2cGFzc0Bwb3N0Z3Jlcy1kZXY6NTQzMi9kZXZkYg==</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>name</key>: <string>api-service</string>
  <key>namespace</key>: <string>microservices-dev</string>
  <key>labels</key>:
    <key>app</key>: <string>api</string>
    <key>tier</key>: <string>backend</string>
    <key>environment</key>: <string>dev</string>
<key>spec</key>:
  <key>selector</key>:
    <key>app</key>: <string>api</string>
    <key>environment</key>: <string>dev</string>
  <key>ports</key>:
    - <key>name</key>: <string>http</string>
      <key>port</key>: <number>80</number>
      <key>targetPort</key>: <number>8080</number>
      <key>protocol</key>: <string>TCP</string>
  <key>type</key>: <string>ClusterIP</string>
<string>---</string>
<key>apiVersion</key>: <string>apps/v1</string>
<key>kind</key>: <string>Deployment</string>
<key>metadata</key>:
  <key>name</key>: <string>api-deployment</string>
  <key>namespace</key>: <string>microservices-dev</string>
  <key>labels</key>:
    <key>app</key>: <string>api</string>
    <key>tier</key>: <string>backend</string>
    <key>environment</key>: <string>dev</string>
<key>spec</key>:
  <key>replicas</key>: <number>1</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>api</string>
      <key>environment</key>: <string>dev</string>
  <key>template</key>:
    <key>metadata</key>:
      <key>labels</key>:
        <key>app</key>: <string>api</string>
        <key>tier</key>: <string>backend</string>
        <key>environment</key>: <string>dev</string>
    <key>spec</key>:
      <key>containers</key>:
        - <key>name</key>: <string>api</string>
          <key>image</key>: <string>myregistry/api-service:dev</string>
          <key>ports</key>:
            - <key>containerPort</key>: <number>8080</number>
              <key>name</key>: <string>http</string>
          <key>env</key>:
            - <key>name</key>: <string>APP_ENV</string>
              <key>value</key>: <string>development</string>
            - <key>name</key>: <string>DEBUG</string>
              <key>value</key>: <string>"true"</string>
            - <key>name</key>: <string>DATABASE_URL</string>
              <key>valueFrom</key>:
                <key>secretKeyRef</key>:
                  <key>name</key>: <string>api-secrets</string>
                  <key>key</key>: <string>database-url</string>
          <key>resources</key>:
            <key>requests</key>:
              <key>memory</key>: <string>"64Mi"</string>
              <key>cpu</key>: <string>"50m"</string>
            <key>limits</key>:
              <key>memory</key>: <string>"128Mi"</string>
              <key>cpu</key>: <string>"100m"</string>
          <key>livenessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/health</string>
              <key>port</key>: <number>8080</number>
            <key>initialDelaySeconds</key>: <number>30</number>
            <key>periodSeconds</key>: <number>10</number>
          <key>readinessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/ready</string>
              <key>port</key>: <number>8080</number>
            <key>initialDelaySeconds</key>: <number>5</number>
            <key>periodSeconds</key>: <number>5</number>
          <key>args</key>:
            - <string>"server"</string>
            - <string>"--config=/app/config/app.properties"</string>
            - <string>"--workers=2"</string>
            - <string>"--feature=auth"</string>
            - <string>"--feature=metrics"</string>
            - <string>"--verbose"</string>
          <key>volumeMounts</key>:
            - <key>name</key>: <string>config</string>
              <key>mountPath</key>: <string>/app/config</string>
      <key>volumes</key>:
        - <key>name</key>: <string>config</string>
          <key>configMap</key>:
            <key>name</key>: <string>api-config</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">dev/web-service.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ConfigMap</string>
<key>metadata</key>:
  <key>name</key>: <string>web-config</string>
  <key>namespace</key>: <string>microservices-dev</string>
<key>data</key>:
  <key>app.config.json</key>: <string>|</string>
    <string>{</string>
      <string><string>"environment"</string>: "development",</string>
      <string><string>"apiUrl"</string>: "http://api-service",</string>
      <string><string>"debugMode"</string>: true,</string>
      <string><string>"features"</string>: {</string>
        <string><string>"analytics"</string>: false,</string>
        <string><string>"caching"</string>: false</string>
      <string>}</string>
    <string>}</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>name</key>: <string>web-service</string>
  <key>namespace</key>: <string>microservices-dev</string>
  <key>labels</key>:
    <key>app</key>: <string>web</string>
    <key>tier</key>: <string>frontend</string>
    <key>environment</key>: <string>dev</string>
<key>spec</key>:
  <key>selector</key>:
    <key>app</key>: <string>web</string>
    <key>environment</key>: <string>dev</string>
  <key>ports</key>:
    - <key>name</key>: <string>http</string>
      <key>port</key>: <number>80</number>
      <key>targetPort</key>: <number>80</number>
      <key>protocol</key>: <string>TCP</string>
  <key>type</key>: <string>NodePort</string>
<string>---</string>
<key>apiVersion</key>: <string>apps/v1</string>
<key>kind</key>: <string>Deployment</string>
<key>metadata</key>:
  <key>name</key>: <string>web-deployment</string>
  <key>namespace</key>: <string>microservices-dev</string>
  <key>labels</key>:
    <key>app</key>: <string>web</string>
    <key>tier</key>: <string>frontend</string>
    <key>environment</key>: <string>dev</string>
<key>spec</key>:
  <key>replicas</key>: <number>1</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>web</string>
      <key>environment</key>: <string>dev</string>
  <key>template</key>:
    <key>metadata</key>:
      <key>labels</key>:
        <key>app</key>: <string>web</string>
        <key>tier</key>: <string>frontend</string>
        <key>environment</key>: <string>dev</string>
    <key>spec</key>:
      <key>containers</key>:
        - <key>name</key>: <string>web</string>
          <key>image</key>: <string>myregistry/web-frontend:dev</string>
          <key>ports</key>:
            - <key>containerPort</key>: <number>80</number>
              <key>name</key>: <string>http</string>
          <key>env</key>:
            - <key>name</key>: <string>API_URL</string>
              <key>value</key>: <string>"http://api-service"</string>
            - <key>name</key>: <string>APP_ENV</string>
              <key>value</key>: <string>development</string>
            - <key>name</key>: <string>DEBUG_MODE</string>
              <key>value</key>: <string>"true"</string>
          <key>resources</key>:
            <key>requests</key>:
              <key>memory</key>: <string>"64Mi"</string>
              <key>cpu</key>: <string>"50m"</string>
            <key>limits</key>:
              <key>memory</key>: <string>"128Mi"</string>
              <key>cpu</key>: <string>"100m"</string>
          <key>livenessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/</string>
              <key>port</key>: <number>80</number>
            <key>initialDelaySeconds</key>: <number>10</number>
            <key>periodSeconds</key>: <number>10</number>
          <key>readinessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/</string>
              <key>port</key>: <number>80</number>
            <key>initialDelaySeconds</key>: <number>5</number>
            <key>periodSeconds</key>: <number>5</number>
          <key>command</key>: <string>["/app/web-server"]</string>
          <key>args</key>:
            - <string>"serve"</string>
            - <string>"--port=80"</string>
            - <string>"--static-dir=/usr/share/nginx/html"</string>
            - <string>"--api-backend=http://api-service"</string>
            - <string>"--enable-compression"</string>
            - <string>"--enable-cache"</string>
            - <string>"-v"</string>
            - <string>"-v"</string>
          <key>volumeMounts</key>:
            - <key>name</key>: <string>app-config</string>
              <key>mountPath</key>: <string>/usr/share/nginx/html/config</string>
      <key>volumes</key>:
        - <key>name</key>: <string>app-config</string>
          <key>configMap</key>:
            <key>name</key>: <string>web-config</string>
            <key>items</key>:
              - <key>key</key>: <string>app.config.json</string>
                <key>path</key>: <string>config.json</string>
<string>---</string>
<key>apiVersion</key>: <string>networking.k8s.io/v1</string>
<key>kind</key>: <string>Ingress</string>
<key>metadata</key>:
  <key>name</key>: <string>web-ingress</string>
  <key>namespace</key>: <string>microservices-dev</string>
<key>spec</key>:
  <key>ingressClassName</key>: <string>nginx</string>
  <key>rules</key>:
    - <key>host</key>: <string>dev.app.local</string>
      <key>http</key>:
        <key>paths</key>:
          - <key>path</key>: <string>/</string>
            <key>pathType</key>: <string>Prefix</string>
            <key>backend</key>:
              <key>service</key>:
                <key>name</key>: <string>web-service</string>
                <key>port</key>:
                  <key>number</key>: <number>80</number></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">staging/namespace.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Namespace</string>
<key>metadata</key>:
  <key>name</key>: <string>microservices-staging</string>
  <key>labels</key>:
    <key>environment</key>: <string>staging</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">staging/api-service.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ConfigMap</string>
<key>metadata</key>:
  <key>name</key>: <string>api-config</string>
  <key>namespace</key>: <string>microservices-staging</string>
<key>data</key>:
  <key>app.properties</key>: <string>|</string>
    <string>server.port=8080</string>
    <string>server.name=api-service</string>
    <string>server.workers=4</string>
    <string>logging.level=info</string>
    <string>logging.format=json</string>
    <string>logging.output=stdout</string>
    <string>cache.enabled=true</string>
    <string>cache.ttl=300</string>
    <string>cache.backend=redis</string>
    <string>database.pool_size=10</string>
    <string>database.timeout=30</string>
    <string>database.max_idle=5</string>
    <string>metrics.enabled=true</string>
    <string>metrics.port=9090</string>
    <string>environment=staging</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Secret</string>
<key>metadata</key>:
  <key>name</key>: <string>api-secrets</string>
  <key>namespace</key>: <string>microservices-staging</string>
<key>type</key>: <string>Opaque</string>
<key>data</key>:
  <key>database-url</key>: <string>cG9zdGdyZXNxbDovL3N0YWdpbmd1c2VyOnN0YWdpbmdwYXNzQHBvc3RncmVzLXN0YWdpbmc6NTQzMi9zdGFnaW5nZGI=</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>name</key>: <string>api-service</string>
  <key>namespace</key>: <string>microservices-staging</string>
  <key>labels</key>:
    <key>app</key>: <string>api</string>
    <key>tier</key>: <string>backend</string>
    <key>environment</key>: <string>staging</string>
<key>spec</key>:
  <key>selector</key>:
    <key>app</key>: <string>api</string>
    <key>environment</key>: <string>staging</string>
  <key>ports</key>:
    - <key>name</key>: <string>http</string>
      <key>port</key>: <number>80</number>
      <key>targetPort</key>: <number>8080</number>
      <key>protocol</key>: <string>TCP</string>
  <key>type</key>: <string>ClusterIP</string>
<string>---</string>
<key>apiVersion</key>: <string>apps/v1</string>
<key>kind</key>: <string>Deployment</string>
<key>metadata</key>:
  <key>name</key>: <string>api-deployment</string>
  <key>namespace</key>: <string>microservices-staging</string>
  <key>labels</key>:
    <key>app</key>: <string>api</string>
    <key>tier</key>: <string>backend</string>
    <key>environment</key>: <string>staging</string>
<key>spec</key>:
  <key>replicas</key>: <number>2</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>api</string>
      <key>environment</key>: <string>staging</string>
  <key>template</key>:
    <key>metadata</key>:
      <key>labels</key>:
        <key>app</key>: <string>api</string>
        <key>tier</key>: <string>backend</string>
        <key>environment</key>: <string>staging</string>
    <key>spec</key>:
      <key>containers</key>:
        - <key>name</key>: <string>api</string>
          <key>image</key>: <string>myregistry/api-service:staging</string>
          <key>ports</key>:
            - <key>containerPort</key>: <number>8080</number>
              <key>name</key>: <string>http</string>
          <key>env</key>:
            - <key>name</key>: <string>APP_ENV</string>
              <key>value</key>: <string>staging</string>
            - <key>name</key>: <string>CACHE_ENABLED</string>
              <key>value</key>: <string>"true"</string>
            - <key>name</key>: <string>DATABASE_URL</string>
              <key>valueFrom</key>:
                <key>secretKeyRef</key>:
                  <key>name</key>: <string>api-secrets</string>
                  <key>key</key>: <string>database-url</string>
          <key>resources</key>:
            <key>requests</key>:
              <key>memory</key>: <string>"256Mi"</string>
              <key>cpu</key>: <string>"200m"</string>
            <key>limits</key>:
              <key>memory</key>: <string>"512Mi"</string>
              <key>cpu</key>: <string>"500m"</string>
          <key>livenessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/health</string>
              <key>port</key>: <number>8080</number>
            <key>initialDelaySeconds</key>: <number>30</number>
            <key>periodSeconds</key>: <number>10</number>
          <key>readinessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/ready</string>
              <key>port</key>: <number>8080</number>
            <key>initialDelaySeconds</key>: <number>5</number>
            <key>periodSeconds</key>: <number>5</number>
          <key>args</key>:
            - <string>"server"</string>
            - <string>"--config=/app/config/app.properties"</string>
            - <string>"--workers=4"</string>
            - <string>"--feature=auth"</string>
            - <string>"--feature=metrics"</string>
            - <string>"--feature=rate-limiting"</string>
            - <string>"--feature=caching"</string>
            - <string>"--log-format=json"</string>
            - <string>"--graceful-timeout=30s"</string>
          <key>volumeMounts</key>:
            - <key>name</key>: <string>config</string>
              <key>mountPath</key>: <string>/app/config</string>
      <key>volumes</key>:
        - <key>name</key>: <string>config</string>
          <key>configMap</key>:
            <key>name</key>: <string>api-config</string>
<string>---</string>
<key>apiVersion</key>: <string>autoscaling/v2</string>
<key>kind</key>: <string>HorizontalPodAutoscaler</string>
<key>metadata</key>:
  <key>name</key>: <string>api-hpa</string>
  <key>namespace</key>: <string>microservices-staging</string>
<key>spec</key>:
  <key>scaleTargetRef</key>:
    <key>apiVersion</key>: <string>apps/v1</string>
    <key>kind</key>: <string>Deployment</string>
    <key>name</key>: <string>api-deployment</string>
  <key>minReplicas</key>: <number>2</number>
  <key>maxReplicas</key>: <number>5</number>
  <key>metrics</key>:
    - <key>type</key>: <string>Resource</string>
      <key>resource</key>:
        <key>name</key>: <string>cpu</string>
        <key>target</key>:
          <key>type</key>: <string>Utilization</string>
          <key>averageUtilization</key>: <number>70</number>
    - <key>type</key>: <string>Resource</string>
      <key>resource</key>:
        <key>name</key>: <string>memory</string>
        <key>target</key>:
          <key>type</key>: <string>Utilization</string>
          <key>averageUtilization</key>: <number>80</number></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">staging/web-service.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ConfigMap</string>
<key>metadata</key>:
  <key>name</key>: <string>web-config</string>
  <key>namespace</key>: <string>microservices-staging</string>
<key>data</key>:
  <key>app.config.json</key>: <string>|</string>
    <string>{</string>
      <string><string>"environment"</string>: "staging",</string>
      <string><string>"apiUrl"</string>: "http://api-service",</string>
      <string><string>"debugMode"</string>: false,</string>
      <string><string>"features"</string>: {</string>
        <string><string>"analytics"</string>: true,</string>
        <string><string>"caching"</string>: true,</string>
        <string><string>"cdnEnabled"</string>: true</string>
      <string>}</string>
    <string>}</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>name</key>: <string>web-service</string>
  <key>namespace</key>: <string>microservices-staging</string>
  <key>labels</key>:
    <key>app</key>: <string>web</string>
    <key>tier</key>: <string>frontend</string>
    <key>environment</key>: <string>staging</string>
<key>spec</key>:
  <key>selector</key>:
    <key>app</key>: <string>web</string>
    <key>environment</key>: <string>staging</string>
  <key>ports</key>:
    - <key>name</key>: <string>http</string>
      <key>port</key>: <number>80</number>
      <key>targetPort</key>: <number>80</number>
      <key>protocol</key>: <string>TCP</string>
  <key>type</key>: <string>LoadBalancer</string>
<string>---</string>
<key>apiVersion</key>: <string>apps/v1</string>
<key>kind</key>: <string>Deployment</string>
<key>metadata</key>:
  <key>name</key>: <string>web-deployment</string>
  <key>namespace</key>: <string>microservices-staging</string>
  <key>labels</key>:
    <key>app</key>: <string>web</string>
    <key>tier</key>: <string>frontend</string>
    <key>environment</key>: <string>staging</string>
<key>spec</key>:
  <key>replicas</key>: <number>2</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>web</string>
      <key>environment</key>: <string>staging</string>
  <key>template</key>:
    <key>metadata</key>:
      <key>labels</key>:
        <key>app</key>: <string>web</string>
        <key>tier</key>: <string>frontend</string>
        <key>environment</key>: <string>staging</string>
    <key>spec</key>:
      <key>containers</key>:
        - <key>name</key>: <string>web</string>
          <key>image</key>: <string>myregistry/web-frontend:staging</string>
          <key>ports</key>:
            - <key>containerPort</key>: <number>80</number>
              <key>name</key>: <string>http</string>
          <key>env</key>:
            - <key>name</key>: <string>API_URL</string>
              <key>value</key>: <string>"http://api-service"</string>
            - <key>name</key>: <string>APP_ENV</string>
              <key>value</key>: <string>staging</string>
            - <key>name</key>: <string>CDN_ENABLED</string>
              <key>value</key>: <string>"true"</string>
          <key>resources</key>:
            <key>requests</key>:
              <key>memory</key>: <string>"128Mi"</string>
              <key>cpu</key>: <string>"100m"</string>
            <key>limits</key>:
              <key>memory</key>: <string>"256Mi"</string>
              <key>cpu</key>: <string>"200m"</string>
          <key>livenessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/health</string>
              <key>port</key>: <number>80</number>
            <key>initialDelaySeconds</key>: <number>10</number>
            <key>periodSeconds</key>: <number>10</number>
          <key>readinessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/health</string>
              <key>port</key>: <number>80</number>
            <key>initialDelaySeconds</key>: <number>5</number>
            <key>periodSeconds</key>: <number>5</number>
          <key>command</key>: <string>["/app/web-server"]</string>
          <key>args</key>:
            - <string>"serve"</string>
            - <string>"--port=80"</string>
            - <string>"--static-dir=/usr/share/nginx/html"</string>
            - <string>"--api-backend=http://api-service"</string>
            - <string>"--enable-compression"</string>
            - <string>"--enable-cache"</string>
            - <string>"--cache-ttl=300"</string>
            - <string>"--enable-metrics"</string>
            - <string>"--metrics-port=9090"</string>
            - <string>"--access-log=/var/log/access.log"</string>
            - <string>"--error-log=/var/log/error.log"</string>
            - <string>"-v"</string>
          <key>volumeMounts</key>:
            - <key>name</key>: <string>app-config</string>
              <key>mountPath</key>: <string>/usr/share/nginx/html/config</string>
      <key>volumes</key>:
        - <key>name</key>: <string>app-config</string>
          <key>configMap</key>:
            <key>name</key>: <string>web-config</string>
            <key>items</key>:
              - <key>key</key>: <string>app.config.json</string>
                <key>path</key>: <string>config.json</string>
<string>---</string>
<key>apiVersion</key>: <string>networking.k8s.io/v1</string>
<key>kind</key>: <string>Ingress</string>
<key>metadata</key>:
  <key>name</key>: <string>web-ingress</string>
  <key>namespace</key>: <string>microservices-staging</string>
  <key>annotations</key>:
    <key>nginx.ingress.kubernetes.io/ssl-redirect</key>: <string>"true"</string>
    <key>cert-manager.io/cluster-issuer</key>: <string>"letsencrypt-staging"</string>
<key>spec</key>:
  <key>ingressClassName</key>: <string>nginx</string>
  <key>tls</key>:
    - <key>hosts</key>:
        - <string>staging.app.example.com</string>
      <key>secretName</key>: <string>staging-tls-cert</string>
  <key>rules</key>:
    - <key>host</key>: <string>staging.app.example.com</string>
      <key>http</key>:
        <key>paths</key>:
          - <key>path</key>: <string>/</string>
            <key>pathType</key>: <string>Prefix</string>
            <key>backend</key>:
              <key>service</key>:
                <key>name</key>: <string>web-service</string>
                <key>port</key>:
                  <key>number</key>: <number>80</number></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">prod/namespace.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Namespace</string>
<key>metadata</key>:
  <key>name</key>: <string>microservices-prod</string>
  <key>labels</key>:
    <key>environment</key>: <string>prod</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">prod/api-service.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ConfigMap</string>
<key>metadata</key>:
  <key>name</key>: <string>api-config</string>
  <key>namespace</key>: <string>microservices-prod</string>
<key>data</key>:
  <key>app.properties</key>: <string>|</string>
    <string>server.port=8080</string>
    <string>server.name=api-service</string>
    <string>server.workers=8</string>
    <string>server.max_connections=1000</string>
    <string>logging.level=warn</string>
    <string>logging.format=json</string>
    <string>logging.output=stdout</string>
    <string>logging.sample_rate=0.1</string>
    <string>cache.enabled=true</string>
    <string>cache.ttl=3600</string>
    <string>cache.backend=redis-cluster</string>
    <string>cache.max_size=1000</string>
    <string>database.pool_size=20</string>
    <string>database.max_pool_size=50</string>
    <string>database.timeout=30</string>
    <string>database.max_idle=10</string>
    <string>metrics.enabled=true</string>
    <string>metrics.port=9090</string>
    <string>metrics.path=/metrics</string>
    <string>security.rate_limit=1000</string>
    <string>security.jwt_expiry=3600</string>
    <string>environment=production</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Secret</string>
<key>metadata</key>:
  <key>name</key>: <string>api-secrets</string>
  <key>namespace</key>: <string>microservices-prod</string>
<key>type</key>: <string>Opaque</string>
<key>data</key>:
  <key>database-url</key>: <string>cG9zdGdyZXNxbDovL3Byb2R1c2VyOnByb2RwYXNzQHByb2QtZGItY2x1c3Rlci5yZHMuYW1hem9uYXdzLmNvbTo1NDMyL3Byb2RkYg==</string>
  <key>api-key</key>: <string>YWJjZGVmZ2hpams=</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>name</key>: <string>api-service</string>
  <key>namespace</key>: <string>microservices-prod</string>
  <key>labels</key>:
    <key>app</key>: <string>api</string>
    <key>tier</key>: <string>backend</string>
    <key>environment</key>: <string>prod</string>
<key>spec</key>:
  <key>selector</key>:
    <key>app</key>: <string>api</string>
    <key>environment</key>: <string>prod</string>
  <key>ports</key>:
    - <key>name</key>: <string>http</string>
      <key>port</key>: <number>80</number>
      <key>targetPort</key>: <number>8080</number>
      <key>protocol</key>: <string>TCP</string>
  <key>type</key>: <string>ClusterIP</string>
<string>---</string>
<key>apiVersion</key>: <string>apps/v1</string>
<key>kind</key>: <string>Deployment</string>
<key>metadata</key>:
  <key>name</key>: <string>api-deployment</string>
  <key>namespace</key>: <string>microservices-prod</string>
  <key>labels</key>:
    <key>app</key>: <string>api</string>
    <key>tier</key>: <string>backend</string>
    <key>environment</key>: <string>prod</string>
<key>spec</key>:
  <key>replicas</key>: <number>3</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>api</string>
      <key>environment</key>: <string>prod</string>
  <key>strategy</key>:
    <key>type</key>: <string>RollingUpdate</string>
    <key>rollingUpdate</key>:
      <key>maxSurge</key>: <number>1</number>
      <key>maxUnavailable</key>: <number>0</number>
  <key>template</key>:
    <key>metadata</key>:
      <key>labels</key>:
        <key>app</key>: <string>api</string>
        <key>tier</key>: <string>backend</string>
        <key>environment</key>: <string>prod</string>
    <key>spec</key>:
      <key>affinity</key>:
        <key>podAntiAffinity</key>:
          <key>preferredDuringSchedulingIgnoredDuringExecution</key>:
            - <key>weight</key>: <number>100</number>
              <key>podAffinityTerm</key>:
                <key>labelSelector</key>:
                  <key>matchExpressions</key>:
                    - <key>key</key>: <string>app</string>
                      <key>operator</key>: <string>In</string>
                      <key>values</key>:
                        - <string>api</string>
                <key>topologyKey</key>: <string>kubernetes.io/hostname</string>
      <key>containers</key>:
        - <key>name</key>: <string>api</string>
          <key>image</key>: <string>myregistry/api-service:v1.2.3</string>
          <key>ports</key>:
            - <key>containerPort</key>: <number>8080</number>
              <key>name</key>: <string>http</string>
          <key>env</key>:
            - <key>name</key>: <string>APP_ENV</string>
              <key>value</key>: <string>production</string>
            - <key>name</key>: <string>CACHE_ENABLED</string>
              <key>value</key>: <string>"true"</string>
            - <key>name</key>: <string>METRICS_ENABLED</string>
              <key>value</key>: <string>"true"</string>
            - <key>name</key>: <string>DATABASE_URL</string>
              <key>valueFrom</key>:
                <key>secretKeyRef</key>:
                  <key>name</key>: <string>api-secrets</string>
                  <key>key</key>: <string>database-url</string>
            - <key>name</key>: <string>API_KEY</string>
              <key>valueFrom</key>:
                <key>secretKeyRef</key>:
                  <key>name</key>: <string>api-secrets</string>
                  <key>key</key>: <string>api-key</string>
          <key>resources</key>:
            <key>requests</key>:
              <key>memory</key>: <string>"512Mi"</string>
              <key>cpu</key>: <string>"500m"</string>
            <key>limits</key>:
              <key>memory</key>: <string>"1Gi"</string>
              <key>cpu</key>: <string>"1000m"</string>
          <key>livenessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/health</string>
              <key>port</key>: <number>8080</number>
            <key>initialDelaySeconds</key>: <number>30</number>
            <key>periodSeconds</key>: <number>10</number>
            <key>timeoutSeconds</key>: <number>5</number>
            <key>failureThreshold</key>: <number>3</number>
          <key>readinessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/ready</string>
              <key>port</key>: <number>8080</number>
            <key>initialDelaySeconds</key>: <number>5</number>
            <key>periodSeconds</key>: <number>5</number>
            <key>timeoutSeconds</key>: <number>3</number>
            <key>successThreshold</key>: <number>1</number>
            <key>failureThreshold</key>: <number>3</number>
          <key>args</key>:
            - <string>"server"</string>
            - <string>"--config=/app/config/app.properties"</string>
            - <string>"--workers=8"</string>
            - <string>"--feature=auth"</string>
            - <string>"--feature=metrics"</string>
            - <string>"--feature=rate-limiting"</string>
            - <string>"--feature=caching"</string>
            - <string>"--feature=circuit-breaker"</string>
            - <string>"--feature=request-tracing"</string>
            - <string>"--log-format=json"</string>
            - <string>"--log-sample-rate=0.1"</string>
            - <string>"--graceful-timeout=60s"</string>
            - <string>"--max-request-size=10MB"</string>
            - <string>"--request-timeout=30s"</string>
          <key>volumeMounts</key>:
            - <key>name</key>: <string>config</string>
              <key>mountPath</key>: <string>/app/config</string>
      <key>volumes</key>:
        - <key>name</key>: <string>config</string>
          <key>configMap</key>:
            <key>name</key>: <string>api-config</string>
<string>---</string>
<key>apiVersion</key>: <string>autoscaling/v2</string>
<key>kind</key>: <string>HorizontalPodAutoscaler</string>
<key>metadata</key>:
  <key>name</key>: <string>api-hpa</string>
  <key>namespace</key>: <string>microservices-prod</string>
<key>spec</key>:
  <key>scaleTargetRef</key>:
    <key>apiVersion</key>: <string>apps/v1</string>
    <key>kind</key>: <string>Deployment</string>
    <key>name</key>: <string>api-deployment</string>
  <key>minReplicas</key>: <number>3</number>
  <key>maxReplicas</key>: <number>10</number>
  <key>metrics</key>:
    - <key>type</key>: <string>Resource</string>
      <key>resource</key>:
        <key>name</key>: <string>cpu</string>
        <key>target</key>:
          <key>type</key>: <string>Utilization</string>
          <key>averageUtilization</key>: <number>60</number>
    - <key>type</key>: <string>Resource</string>
      <key>resource</key>:
        <key>name</key>: <string>memory</string>
        <key>target</key>:
          <key>type</key>: <string>Utilization</string>
          <key>averageUtilization</key>: <number>70</number>
<string>---</string>
<key>apiVersion</key>: <string>policy/v1</string>
<key>kind</key>: <string>PodDisruptionBudget</string>
<key>metadata</key>:
  <key>name</key>: <string>api-pdb</string>
  <key>namespace</key>: <string>microservices-prod</string>
<key>spec</key>:
  <key>minAvailable</key>: <number>2</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>api</string>
      <key>environment</key>: <string>prod</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">prod/web-service.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ConfigMap</string>
<key>metadata</key>:
  <key>name</key>: <string>web-config</string>
  <key>namespace</key>: <string>microservices-prod</string>
<key>data</key>:
  <key>app.config.json</key>: <string>|</string>
    <string>{</string>
      <string><string>"environment"</string>: "production",</string>
      <string><string>"apiUrl"</string>: "https://api.example.com",</string>
      <string><string>"debugMode"</string>: false,</string>
      <string><string>"features"</string>: {</string>
        <string><string>"analytics"</string>: true,</string>
        <string><string>"caching"</string>: true,</string>
        <string><string>"cdnEnabled"</string>: true,</string>
        <string><string>"performanceMonitoring"</string>: true</string>
      <string>},</string>
      <string><string>"cdn"</string>: {</string>
        <string><string>"url"</string>: "https://cdn.example.com"</string>
      <string>}</string>
    <string>}</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Service</string>
<key>metadata</key>:
  <key>name</key>: <string>web-service</string>
  <key>namespace</key>: <string>microservices-prod</string>
  <key>labels</key>:
    <key>app</key>: <string>web</string>
    <key>tier</key>: <string>frontend</string>
    <key>environment</key>: <string>prod</string>
  <key>annotations</key>:
    <key>service.beta.kubernetes.io/aws-load-balancer-type</key>: <string>"nlb"</string>
<key>spec</key>:
  <key>selector</key>:
    <key>app</key>: <string>web</string>
    <key>environment</key>: <string>prod</string>
  <key>ports</key>:
    - <key>name</key>: <string>http</string>
      <key>port</key>: <number>80</number>
      <key>targetPort</key>: <number>80</number>
      <key>protocol</key>: <string>TCP</string>
  <key>type</key>: <string>LoadBalancer</string>
<string>---</string>
<key>apiVersion</key>: <string>apps/v1</string>
<key>kind</key>: <string>Deployment</string>
<key>metadata</key>:
  <key>name</key>: <string>web-deployment</string>
  <key>namespace</key>: <string>microservices-prod</string>
  <key>labels</key>:
    <key>app</key>: <string>web</string>
    <key>tier</key>: <string>frontend</string>
    <key>environment</key>: <string>prod</string>
<key>spec</key>:
  <key>replicas</key>: <number>3</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>web</string>
      <key>environment</key>: <string>prod</string>
  <key>strategy</key>:
    <key>type</key>: <string>RollingUpdate</string>
    <key>rollingUpdate</key>:
      <key>maxSurge</key>: <number>1</number>
      <key>maxUnavailable</key>: <number>0</number>
  <key>template</key>:
    <key>metadata</key>:
      <key>labels</key>:
        <key>app</key>: <string>web</string>
        <key>tier</key>: <string>frontend</string>
        <key>environment</key>: <string>prod</string>
    <key>spec</key>:
      <key>affinity</key>:
        <key>podAntiAffinity</key>:
          <key>preferredDuringSchedulingIgnoredDuringExecution</key>:
            - <key>weight</key>: <number>100</number>
              <key>podAffinityTerm</key>:
                <key>labelSelector</key>:
                  <key>matchExpressions</key>:
                    - <key>key</key>: <string>app</string>
                      <key>operator</key>: <string>In</string>
                      <key>values</key>:
                        - <string>web</string>
                <key>topologyKey</key>: <string>kubernetes.io/hostname</string>
      <key>containers</key>:
        - <key>name</key>: <string>web</string>
          <key>image</key>: <string>myregistry/web-frontend:v1.2.3</string>
          <key>ports</key>:
            - <key>containerPort</key>: <number>80</number>
              <key>name</key>: <string>http</string>
          <key>env</key>:
            - <key>name</key>: <string>API_URL</string>
              <key>value</key>: <string>"https://api.example.com"</string>
            - <key>name</key>: <string>APP_ENV</string>
              <key>value</key>: <string>production</string>
            - <key>name</key>: <string>CDN_ENABLED</string>
              <key>value</key>: <string>"true"</string>
            - <key>name</key>: <string>CACHE_CONTROL</string>
              <key>value</key>: <string>"max-age=3600"</string>
          <key>resources</key>:
            <key>requests</key>:
              <key>memory</key>: <string>"256Mi"</string>
              <key>cpu</key>: <string>"200m"</string>
            <key>limits</key>:
              <key>memory</key>: <string>"512Mi"</string>
              <key>cpu</key>: <string>"500m"</string>
          <key>livenessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/health</string>
              <key>port</key>: <number>80</number>
            <key>initialDelaySeconds</key>: <number>10</number>
            <key>periodSeconds</key>: <number>10</number>
            <key>timeoutSeconds</key>: <number>5</number>
            <key>failureThreshold</key>: <number>3</number>
          <key>readinessProbe</key>:
            <key>httpGet</key>:
              <key>path</key>: <string>/health</string>
              <key>port</key>: <number>80</number>
            <key>initialDelaySeconds</key>: <number>5</number>
            <key>periodSeconds</key>: <number>5</number>
            <key>timeoutSeconds</key>: <number>3</number>
            <key>successThreshold</key>: <number>1</number>
            <key>failureThreshold</key>: <number>3</number>
          <key>command</key>: <string>["/app/web-server"]</string>
          <key>args</key>:
            - <string>"serve"</string>
            - <string>"--port=80"</string>
            - <string>"--static-dir=/usr/share/nginx/html"</string>
            - <string>"--api-backend=https://api-service"</string>
            - <string>"--enable-compression"</string>
            - <string>"--enable-cache"</string>
            - <string>"--cache-ttl=3600"</string>
            - <string>"--enable-metrics"</string>
            - <string>"--metrics-port=9090"</string>
            - <string>"--enable-security-headers"</string>
            - <string>"--enable-rate-limiting"</string>
            - <string>"--rate-limit=100"</string>
            - <string>"--enable-access-log"</string>
            - <string>"--access-log-format=json"</string>
            - <string>"--enable-cdn"</string>
            - <string>"--cdn-url=https://cdn.example.com"</string>
            - <string>"--graceful-timeout=30s"</string>
            - <string>"--read-timeout=30s"</string>
            - <string>"--write-timeout=30s"</string>
          <key>volumeMounts</key>:
            - <key>name</key>: <string>app-config</string>
              <key>mountPath</key>: <string>/usr/share/nginx/html/config</string>
      <key>volumes</key>:
        - <key>name</key>: <string>app-config</string>
          <key>configMap</key>:
            <key>name</key>: <string>web-config</string>
            <key>items</key>:
              - <key>key</key>: <string>app.config.json</string>
                <key>path</key>: <string>config.json</string>
<string>---</string>
<key>apiVersion</key>: <string>networking.k8s.io/v1</string>
<key>kind</key>: <string>Ingress</string>
<key>metadata</key>:
  <key>name</key>: <string>web-ingress</string>
  <key>namespace</key>: <string>microservices-prod</string>
  <key>annotations</key>:
    <key>nginx.ingress.kubernetes.io/ssl-redirect</key>: <string>"true"</string>
    <key>cert-manager.io/cluster-issuer</key>: <string>"letsencrypt-prod"</string>
    <key>nginx.ingress.kubernetes.io/rate-limit</key>: <string>"100"</string>
<key>spec</key>:
  <key>ingressClassName</key>: <string>nginx</string>
  <key>tls</key>:
    - <key>hosts</key>:
        - <string>app.example.com</string>
        - <string>www.app.example.com</string>
      <key>secretName</key>: <string>prod-tls-cert</string>
  <key>rules</key>:
    - <key>host</key>: <string>app.example.com</string>
      <key>http</key>:
        <key>paths</key>:
          - <key>path</key>: <string>/</string>
            <key>pathType</key>: <string>Prefix</string>
            <key>backend</key>:
              <key>service</key>:
                <key>name</key>: <string>web-service</string>
                <key>port</key>:
                  <key>number</key>: <number>80</number>
    - <key>host</key>: <string>www.app.example.com</string>
      <key>http</key>:
        <key>paths</key>:
          - <key>path</key>: <string>/</string>
            <key>pathType</key>: <string>Prefix</string>
            <key>backend</key>:
              <key>service</key>:
                <key>name</key>: <string>web-service</string>
                <key>port</key>:
                  <key>number</key>: <number>80</number>
<string>---</string>
<key>apiVersion</key>: <string>policy/v1</string>
<key>kind</key>: <string>PodDisruptionBudget</string>
<key>metadata</key>:
  <key>name</key>: <string>web-pdb</string>
  <key>namespace</key>: <string>microservices-prod</string>
<key>spec</key>:
  <key>minAvailable</key>: <number>2</number>
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>web</string>
      <key>environment</key>: <string>prod</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">prod/monitoring.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ServiceMonitor</string>
<key>metadata</key>:
  <key>name</key>: <string>api-metrics</string>
  <key>namespace</key>: <string>microservices-prod</string>
  <key>labels</key>:
    <key>app</key>: <string>api</string>
    <key>monitoring</key>: <string>prometheus</string>
    <key>environment</key>: <string>prod</string>
<key>spec</key>:
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>api</string>
      <key>environment</key>: <string>prod</string>
  <key>endpoints</key>:
    - <key>port</key>: <string>http</string>
      <key>path</key>: <string>/metrics</string>
      <key>interval</key>: <string>30s</string>
<string>---</string>
<key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ServiceMonitor</string>
<key>metadata</key>:
  <key>name</key>: <string>web-metrics</string>
  <key>namespace</key>: <string>microservices-prod</string>
  <key>labels</key>:
    <key>app</key>: <string>web</string>
    <key>monitoring</key>: <string>prometheus</string>
    <key>environment</key>: <string>prod</string>
<key>spec</key>:
  <key>selector</key>:
    <key>matchLabels</key>:
      <key>app</key>: <string>web</string>
      <key>environment</key>: <string>prod</string>
  <key>endpoints</key>:
    - <key>port</key>: <string>http</string>
      <key>path</key>: <string>/metrics</string>
      <key>interval</key>: <string>30s</string></bkl-code>
</div>
</div>

</div>




</section>

<section id="namespace">
<h2><a name="namespace">namespace</a></h2>



<p><p>We start with the single-resource <highlight>namespace.yaml</highlight> files.</p>

<p><highlight>prod/namespace.yaml</highlight> will form our base layer. This choice means that all other environments are expressed as differences from production, encouraging minimizing those differences.</p>

<p>We'll use <highlight>$""</highlight> interpolation set the namespace name based on the environment.</p>

<p>We'll keep the original namespace/api-service/web-service/monitoring split to match the ways users were used to working with the config.</p>
</p>




<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">bkl/namespace.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>Namespace</string>
<key>metadata</key>:
  <key>name</key>: <string>$"microservices-{metadata.labels.environment}"</string>
  <key>labels</key>:
    <key>environment</key>: <string>prod</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">bkl/namespace.staging.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>$match</key>:
  <key>kind</key>: <string>Namespace</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>environment</key>: <string>staging</string></bkl-code>
</div>
</div>

</div>





<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">bkl/namespace.staging.dev.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>$match</key>:
  <key>kind</key>: <string>Namespace</string>
<key>metadata</key>:
  <key>labels</key>:
    <key>environment</key>: <string>dev</string></bkl-code>
</div>
</div>

</div>




<p><p>This conversion is simple enough to do by hand. We'll use tools for some of the more complex later transformations.</p>

<p>Once we have bkl files that look correct and parse, we validate them against the original configs.</p>

<p>Using <highlight>yq</highlight> to sort keys eliminates diffs that are just about ordering.</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>diff</command> <flag>-ud</flag> <flag>--color</flag> <operator>&lt;</operator><operator>(</operator><command>yq</command> <string>'sort_keys(..)'</string> <argument>prod/namespace.yaml</argument><operator>)</operator> <operator>&lt;</operator><operator>(<command></operator>bkl</command> <argument>bkl/namespace.yaml</argument><operator>)</operator>
<prompt>$ </prompt><command>diff</command> <flag>-ud</flag> <flag>--color</flag> <operator>&lt;</operator><operator>(</operator><command>yq</command> <string>'sort_keys(..)'</string> <argument>staging/namespace.yaml</argument><operator>)</operator> <operator>&lt;</operator><operator>(<command></operator>bkl</command> <argument>bkl/namespace.staging.yaml</argument><operator>)</operator>
<prompt>$ </prompt><command>diff</command> <flag>-ud</flag> <flag>--color</flag> <operator>&lt;<operator></operator>(</operator><command>yq</command> <string>'sort_keys(..)'</string> <argument>dev/namespace.yaml</argument><operator>)</operator> <operator>&lt;<operator></operator>(</operator><command>bkl</command> <argument>bkl/namespace.staging.dev.yaml</argument><operator>)</operator></bkl-code>
</div>

</div>




</section>

<section id="api-service">
<h2><a name="api-service">api-service</a></h2>



<p><p>Next, we'll convert the <highlight>api-service.yaml</highlight> files.</p>

<p>Use <highlight>yq</highlight> to split the config into files named by resource type:</p>
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <command></prompt>yq</command> <flag>-s</flag> <string>'.kind'</string> <argument>prod/api-service.yaml</argument></bkl-code>
</div>

</div>




<p><p>For the ConfigMap, we'll use <highlight>$encode: properties</highlight> to convert to an embedded properties string.</p>
</p>




<div class="example-container expandable-container">

<div class="label-container">
<label class="label-spacing">bkl/api-service.yaml</label>
<div class="code-wrapper">

<button class="expand-toggle" onclick="toggleExpand(this)" aria-expanded="false">
›
</button>

<bkl-code class="code-labeled collapsed"><key>apiVersion</key>: <string>v1</string>
<key>kind</key>: <string>ConfigMap</string>
<key>metadata</key>:
  <key>name</key>: <string>api-config</string>
  <key>namespace</key>: <string>microservices-prod</string>
<key>data</key>:
  <key>app.properties</key>:
    <key>$encode</key>: <string>properties</string>
    <key>server</key>:
      <key>port</key>: <number>8080</number>
      <key>name</key>: <string>api-service</string>
      <key>workers</key>: <number>8</number>
      <key>max_connections</key>: <number>1000</number>
    <key>logging</key>:
      <key>level</key>: <string>warn</string>
      <key>format</key>: <string>json</string>
      <key>output</key>: <string>stdout</string>
      <key>sample_rate</key>: <number>0.1</number>
    <key>cache</key>:
      <key>enabled</key>: <bool>true</bool>
      <key>ttl</key>: <number>3600</number>
      <key>backend</key>: <string>redis-cluster</string>
      <key>max_size</key>: <number>1000</number>
    <key>database</key>:
      <key>pool_size</key>: <number>20</number>
      <key>max_pool_size</key>: <number>50</number>
      <key>timeout</key>: <number>30</number>
      <key>max_idle</key>: <number>10</number>
    <key>metrics</key>:
      <key>enabled</key>: <bool>true</bool>
      <key>port</key>: <number>9090</number>
      <key>path</key>: <string>/metrics</string>
    <key>security</key>:
      <key>rate_limit</key>: <number>1000</number>
      <key>jwt_expiry</key>: <number>3600</number>
    <key>environment</key>: <string>production</string></bkl-code>
</div>
</div>

</div>




</section>


</main>

<script>

function toggleMobileMenu() {
    const nav = document.querySelector('nav');
    const button = document.querySelector('.mobile-menu-button');
    nav.classList.toggle('mobile-open');
    button.textContent = nav.classList.contains('mobile-open') ? '✕ Close' : '☰ Nav';
}


function toggleExpand(button) {
    const wrapper = button.closest('.code-wrapper');
    const codeBlock = wrapper.querySelector('bkl-code');
    const isCollapsed = codeBlock.classList.contains('collapsed');
    
    if (isCollapsed) {
        codeBlock.classList.remove('collapsed');
        button.textContent = '∨';
        button.setAttribute('aria-expanded', 'true');
    } else {
        codeBlock.classList.add('collapsed');
        button.textContent = '›';
        button.setAttribute('aria-expanded', 'false');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const searchBar = document.getElementById('searchBar');
    const sections = Array.from(document.querySelectorAll('main > section'));
    const navList = document.querySelector('nav ol');
    const navItems = Array.from(navList.querySelectorAll('li'));
    
    
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            const nav = document.querySelector('nav');
            const button = document.querySelector('.mobile-menu-button');
            if (nav.classList.contains('mobile-open')) {
                nav.classList.remove('mobile-open');
                button.textContent = '☰ Nav';
            }
        });
    });
    
    const originalOrder = sections.map((section, index) => ({
        element: section,
        navItem: navItems[index],
        id: section.id,
        title: section.querySelector('h2').textContent.toLowerCase(),
        content: section.textContent.toLowerCase()
    }));

    searchBar.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();
        
        if (!query) {
            const main = document.querySelector('main');
            originalOrder.forEach(item => {
                main.appendChild(item.element);
                navList.appendChild(item.navItem);
            });
            window.scrollTo(0, 0);
            return;
        }

        const scored = originalOrder.map(item => {
            let score = 0;
            const keywords = query.split(/\s+/);
            
            keywords.forEach(keyword => {
                if (item.title.includes(keyword)) {
                    score += 5;
                }
                let index = 0;
                let matches = 0;
                while ((index = item.content.indexOf(keyword, index)) !== -1) {
                    matches++;
                    index += keyword.length;
                }
                score += matches;
            });
            
            return { ...item, score };
        });

        const main = document.querySelector('main');
        scored.sort((a, b) => b.score - a.score);
        
        scored.forEach(item => {
            main.appendChild(item.element);
            navList.appendChild(item.navItem);
        });
        
        window.scrollTo(0, 0);
    });
});
</script>

</body>
</html>

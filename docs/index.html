













<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bkl - Layered Configuration Language</title>
<link rel="icon" href="icon.png">
<style>
:root {
	--vivid0: hsl(6deg 96% 26%);
	--vivid1: hsl(8deg 92% 35%);
	--vivid2: hsl(10deg 93% 40%);
	--vivid3: hsl(12deg 86% 47%);
	--vivid4: hsl(14deg 89% 55%);
	--vivid5: hsl(16deg 94% 61%);
	--vivid6: hsl(18deg 100% 70%);
	--vivid7: hsl(20deg 100% 77%);
	--vivid8: hsl(22deg 100% 85%);
	--vivid9: hsl(24deg 100% 93%);
	--neutral0: hsl(210deg 24% 16%);
	--neutral1: hsl(209deg 20% 25%);
	--neutral2: hsl(209deg 18% 30%);
	--neutral3: hsl(209deg 14% 37%);
	--neutral4: hsl(211deg 12% 43%);
	--neutral5: hsl(211deg 10% 53%);
	--neutral6: hsl(211deg 13% 65%);
	--neutral7: hsl(210deg 16% 82%);
	--neutral8: hsl(214deg 15% 91%);
	--neutral9: hsl(216deg 33% 97%);
	--blue0: hsl(234deg 62% 26%);
	--blue1: hsl(232deg 51% 36%);
	--blue2: hsl(230deg 49% 41%);
	--blue3: hsl(228deg 45% 45%);
	--blue4: hsl(227deg 42% 51%);
	--blue5: hsl(227deg 50% 59%);
	--blue6: hsl(225deg 57% 67%);
	--blue7: hsl(224deg 67% 76%);
	--blue8: hsl(221deg 78% 86%);
	--blue9: hsl(221deg 68% 93%);
	--red0: hsl(360deg 92% 20%);
	--red1: hsl(360deg 85% 25%);
	--red2: hsl(360deg 79% 32%);
	--red3: hsl(360deg 72% 38%);
	--red4: hsl(360deg 67% 44%);
	--red5: hsl(360deg 64% 55%);
	--red6: hsl(360deg 71% 66%);
	--red7: hsl(360deg 77% 78%);
	--red8: hsl(360deg 82% 89%);
	--red9: hsl(360deg 100% 97%);
	--yellow0: hsl(43deg 86% 17%);
	--yellow1: hsl(43deg 77% 27%);
	--yellow2: hsl(43deg 72% 37%);
	--yellow3: hsl(42deg 63% 48%);
	--yellow4: hsl(42deg 78% 60%);
	--yellow5: hsl(43deg 89% 70%);
	--yellow6: hsl(43deg 90% 76%);
	--yellow7: hsl(45deg 86% 81%);
	--yellow8: hsl(45deg 90% 88%);
	--yellow9: hsl(45deg 100% 96%);
	--green0: hsl(125deg 86% 14%);
	--green1: hsl(125deg 73% 20%);
	--green2: hsl(125deg 56% 29%);
	--green3: hsl(122deg 47% 35%);
	--green4: hsl(122deg 39% 41%);
	--green5: hsl(123deg 35% 51%);
	--green6: hsl(123deg 38% 63%);
	--green7: hsl(122deg 42% 75%);
	--green8: hsl(126deg 49% 84%);
	--green9: hsl(125deg 65% 93%);
	
	 
	--gap-small: 15px;
	--gap-large: 20px;
	--padding-code: 15px;
	--padding-label: 6px 15px 4px 15px;
	--border-radius: 5px;
	--border-radius-label: 0 5px 5px 5px;
	--operator-size: 30px;
	--operator-padding-top: 27px;
}

@font-face {
	font-family: "komet";
	src: url("komet.woff2");
}

@font-face {
	font-family: "source-code-pro";
	src: url("source-code-pro.woff2");
}

body {
	align-items: stretch;
	background-color: var(--neutral9);
	color: var(--neutral1);
	display: flex;
	font-family: "komet";
	font-size: 17px;
	gap: 50px;
	justify-content: center;
	line-height: 1.4;
	margin: 0;
	min-height: 100vh;
	padding: 20px;
}

nav {
	position: fixed;
	left: 20px;
	top: 20px;
	bottom: 20px;
	width: 200px;
	display: flex;
	flex-direction: column;
}

nav {
	position: relative;
}

nav .nav-scroll-container {
	overflow-y: auto;
	flex: 1;
	margin-top: 10px;
}


nav ol {
	list-style: none;
	margin: 0;
	padding: 0;
}

li {
	padding-bottom: 10px;
}

nav a {
	color: var(--neutral5);
	text-decoration: none;
	font-family: source-code-pro;
}

nav a:hover {
	color: var(--neutral3);
}

main {
	max-width: min(750px, 100vw - 20px);
	margin-left: 250px;
}

h1, h2 {
	margin-bottom: 5px;
	margin-top: 30px;
}

h1 {
	align-items: center;
	color: var(--vivid4);
	display: flex;
	font-size: 30px;
	gap: 10px;
	margin: 0;
	padding: 10px 0 10px 0;
	position: relative;
}

h2 {
	color: var(--vivid2);
	font-family: source-code-pro;
	font-size: 25px;
}

h2 a {
	color: inherit;
	text-decoration: none;
}

p {
	hyphens: auto;
	margin: 0 0 10px 0;
}

a {
	color: var(--blue3);
}

label {
	background: var(--neutral2);
	border-radius: var(--border-radius) var(--border-radius) 0 0;
	color: var(--neutral8);
	font-family: source-code-pro;
	display: block;
	padding: var(--padding-label);
	width: fit-content;
}

label.invisible {
	background: transparent;
	color: transparent;
}

bkl-code {
	color: var(--neutral7);
	background: var(--neutral0);
	border-radius: var(--border-radius);
	display: block;
	font-family: source-code-pro;
	font-size: 16px;
	height: fit-content;
	hyphens: none;
	line-height: 1.5;
	overflow-x: auto;
	overflow-y: auto;
	padding: var(--padding-code);
	tab-size: 4;
	text-align: left;
	white-space: pre;
	width: 100%;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	box-sizing: border-box;
	max-width: 100%;
	min-width: 0;
}



 
label:not(.invisible) + bkl-code {
	border-top-left-radius: 0 !important;
}

 
label.invisible + bkl-code {
	border-top-left-radius: 4px !important;
}

bkl-code + p,
div:has(> bkl-code) + p {
	margin-top: 10px;
}

row {
	display: block;
	max-width: 100%;
	overflow: hidden;
}


op {
	align-items: center;
	display: flex;
	font-size: 30px;
	justify-content: center;
	line-height: 0.5;
	text-align: center;
	white-space: pre;
}

 
.code-container {
	display: flex;
	flex-direction: column;
	min-width: 0;
	overflow: hidden;
}

.example-container {
	display: flex;
	flex-direction: column;
	gap: var(--gap-small);
	margin: var(--gap-large) 0;
}

.grid-container {
	display: grid;
	align-items: stretch;
	column-gap: var(--gap-small);
	max-width: 100%;
	overflow: hidden;
}

.grid-2-col {
	grid-template-columns: 1fr 1fr;
}

.grid-3-col {
	grid-template-columns: 1fr auto 1fr;
}

.grid-5-col {
	grid-template-columns: 1fr auto 1fr auto 1fr;
}

.operator-symbol {
	align-items: center;
	display: flex;
	font-size: var(--operator-size);
	justify-content: center;
	line-height: 0.5;
	text-align: center;
	white-space: pre;
}

.operator-with-label {
	padding-top: var(--operator-padding-top);
}

.code-labeled {
	margin-top: 0;
	flex-grow: 1;
	border-radius: var(--border-radius-label);
	border-top-left-radius: 0;
}

.code-unlabeled {
	flex-grow: 1;
	height: 100%;
}

.label-container {
	display: flex;
	flex-direction: column;
	flex-shrink: 0;
}

.label-spacing {
	margin-bottom: 0;
}

.error-display {
	display: flex;
	align-items: center;
	justify-content: center;
	height: 100%;
	font-size: 24px;
	font-weight: bold;
}

 
.code-wrapper {
	position: relative;
}

.expand-toggle {
	position: absolute;
	top: 10px;
	right: 10px;
	z-index: 10;
	background: var(--blue4);
	color: var(--neutral9);
	border: 1px solid var(--blue3);
	border-radius: 3px;
	padding: 2px 8px;
	font-size: 14px;
	cursor: pointer;
	font-family: source-code-pro;
	transition: background-color 0.2s;
}

.expand-toggle:hover {
	background: var(--blue3);
}

bkl-code.collapsed {
	max-height: 90px;
	overflow: hidden;
	position: relative;
}

bkl-code.collapsed::after {
	content: '';
	position: absolute;
	bottom: 0;
	left: 0;
	right: 0;
	height: 40px;
	background: linear-gradient(to bottom, transparent, var(--neutral0));
	pointer-events: none;
}

key {
	color: var(--yellow4);
}

prompt {
	user-select: none;
	-webkit-user-select: none;
	color: var(--neutral5);
}

cmd {
	color: var(--blue5);
}

command {
	color: var(--blue5);
	font-weight: 500;
}

builtin {
	color: var(--blue5);
	font-weight: 500;
}

operator {
	color: var(--vivid5);
	font-weight: 600;
}

argument {
	color: var(--neutral8);
}

variable {
	color: var(--green5);
}

string {
	color: var(--green6);
}

number {
	color: var(--green6);
}

bool {
	color: var(--green6);
}

flag {
	color: var(--vivid3);
}

comment {
	color: var(--neutral5);
	font-style: italic;
}

keyword {
	color: var(--red5);
}

escape {
	color: var(--vivid3);
	font-weight: 600;
}

 
bkl-code highlight,
bkl-code highlight > * {
	color: var(--red6);
	background: transparent;
}

 
p highlight {
	background: var(--neutral8);
	color: var(--red6);
	display: inline-block;
	font-family: source-code-pro;
	font-size: 15px;
	padding: 0 3px 0 3px;
	white-space: nowrap;
}

p highlight * {
	color: var(--red6) !important;
}

 
addition {
	color: var(--green5);
}

deletion {
	color: var(--red5);
}

file-header {
	color: var(--blue5);
	font-weight: 500;
}

hunk-header {
	color: var(--vivid5);
	font-weight: 500;
}

 
.mobile-menu-button {
	display: none;
}

 
@media (max-width: 768px) {
	 
	:root {
		--padding-code: 10px;
		--padding-label: 5px 10px;
		--gap-small: 10px;
		--gap-large: 15px;
		--operator-size: 24px;
	}

	 
	body {
		padding: 10px;
		display: block;
	}

	nav {
		display: none;  
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: white;
		z-index: 1000;
		padding: 20px;
		overflow-y: auto;
	}

	nav.mobile-open {
		display: block;
	}

	 
	.mobile-menu-button {
		display: block;
		position: fixed !important;
		top: 10px !important;
		right: 10px !important;
		z-index: 1001;
		background: var(--vivid4);
		color: white;
		border: none;
		padding: 10px 15px;
		border-radius: 4px;
		font-size: 16px;
		cursor: pointer;
		transform: translateZ(0);  
		-webkit-transform: translateZ(0);
		will-change: transform;
	}

	main {
		max-width: 100%;
		padding: 50px 0 0 0;  
		margin-left: 0;
	}

	h1 {
		font-size: 24px;
		padding: 5px 0;
		flex-wrap: wrap;
	}

	h2 {
		font-size: 20px;
		margin-top: 20px;
	}

	 
	.example-container {
		margin: var(--gap-large) 0;
	}

	.grid-container {
		gap: var(--gap-small);
	}

	 
	bkl-code {
		font-size: 14px;
		padding: var(--padding-code);
		max-width: calc(100vw - 40px);
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
	}

	 
	.operator-symbol {
		font-size: var(--operator-size);
		margin: 10px 0;
	}

	.operator-with-label {
		padding-top: 0;
	}


	 
	label {
		font-size: 14px;
		padding: var(--padding-label);
	}

	 
	table {
		font-size: 14px;
		display: block;
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
		width: max-content;
		max-width: 100%;
	}

	th, td {
		padding: 8px;
		min-width: 100px;
	}

	 
	code {
		font-size: 14px;
		padding: 2px 4px;
	}

	 
	ol, ul {
		padding-left: 20px;
	}

	 
	#searchBar {
		font-size: 16px;  
		width: calc(100% - 20px);
		max-width: 250px;
		padding: 10px;
	}

	 
	.code-container {
		position: relative;
	}

	.code-container::after {
		content: '';
		position: absolute;
		right: 0;
		top: 0;
		bottom: 0;
		width: 20px;
		background: linear-gradient(to right, transparent, rgba(0,0,0,0.1));
		pointer-events: none;
		opacity: 0;
		transition: opacity 0.3s;
	}

	.code-container:has(bkl-code::-webkit-scrollbar-thumb)::after {
		opacity: 1;
	}
}

 
@media (max-width: 480px) {
	:root {
		--padding-code: 8px;
		--padding-label: 4px 8px;
		--gap-small: 8px;
		--gap-large: 12px;
		--operator-size: 20px;
	}

	h1 {
		font-size: 20px;
	}

	h2 {
		font-size: 18px;
	}

	bkl-code {
		font-size: 12px;
	}

	label {
		font-size: 12px;
	}
}

 
@media (min-width: 769px) {
	.mobile-menu-button {
		display: none;
	}

	nav {
		display: flex !important;
		flex-direction: column;
		position: fixed;
		left: 20px;
		top: 20px;
		bottom: 20px;
		width: 200px;
		height: auto;
		padding: 0;
		margin-right: 0;
		background: transparent;
	}

	#searchBar {
		max-width: 180px;
	}
}
</style>
</head>
<body>

<button class="mobile-menu-button" onclick="toggleMobileMenu()">â˜° Nav</button>

<nav>
<input type="text" id="searchBar" placeholder="Search" style="width: 100%; padding: 8px; box-sizing: border-box;">
<div class="nav-scroll-container">
<ol>

	<li><a href="#bkl"><img src="logo.png" alt="" style="height: 0.9em; width: auto; vertical-align: -0.1em; padding-left: 0.05em; padding-right: 0.4em;">BKL</a></li>

	<li><a href="#example">Example</a></li>

	<li><a href="#install">Install</a></li>

	<li><a href="#formats">Formats</a></li>

	<li><a href="#write">Output</a></li>

	<li><a href="#inputs">Inputs</a></li>

	<li><a href="#inheritance">Inheritance</a></li>

	<li><a href="#streams">Streams</a></li>

	<li><a href="#maps">Maps</a></li>

	<li><a href="#lists">Lists</a></li>

	<li><a href="#interp">$""</a></li>

	<li><a href="#decode">$decode</a></li>

	<li><a href="#env">$env</a></li>

	<li><a href="#encode">$encode</a></li>

	<li><a href="#required">$required</a></li>

	<li><a href="#merge">$merge</a></li>

	<li><a href="#replace">$replace</a></li>

	<li><a href="#output">$output</a></li>

	<li><a href="#repeat">$repeat</a></li>

	<li><a href="#defer">$defer</a></li>

	<li><a href="#escape">$$</a></li>

	<li><a href="#toml">TOML</a></li>

	<li><a href="#bklb">bklb</a></li>

	<li><a href="#bkld">bkld</a></li>

	<li><a href="#bkli">bkli</a></li>

	<li><a href="#bklr">bklr</a></li>

	<li><a href="#kubectl-bkl">kubectl bkl</a></li>

	<li><a href="#diff">Comparing Files</a></li>

	<li><a href="#migrate">Migrate</a></li>

	<li><a href="#comparison">Comparison</a></li>

</ol>
</div>
</nav>

<main>


<section id="bkl">
<h2><a name="bkl"><img src="logo.png" alt="" style="height: 0.9em; width: auto; vertical-align: -0.1em; padding-left: 0.05em; padding-right: 0.4em;">BKL</a></h2>



<p>bkl is a templating configuration language without the templates. It's designed to be simple to read and write with obvious behavior.
</p>



<p>Write your configuration in your favorite format: <a href="https://json.org/">JSON</a>, <a href="https://yaml.org/">YAML</a>, or <a href="https://toml.io/">TOML</a>. Layer configurations on top of each other, even from different file formats. Use filenames to define the inheritance. Have as many layers as you like. bkl merges your layers together with sane default behavior that you can override. Export your results in any supported format for human or machine consumption. Use the CLI directly or in scripts or automate with the <a href="https://pkg.go.dev/github.com/gopatchy/bkl">library</a>.

<p>
  <a href="https://pkg.go.dev/github.com/gopatchy/bkl"><img src="go-reference.svg" alt="Go Reference"></a>
  <a href="https://github.com/gopatchy/bkl/"><img alt="GitHub: bkl" src="github-bkl.svg"></a>
  <a href="https://discord.gg/TyDAmqkz3m"><img alt="Discord: bkl" src="discord-bkl.svg"></a>
</p>
</p>



</section>

<section id="example">
<h2><a name="example">Example</a></h2>




<div class="example-container">
<div class="grid-container grid-2-col">

<div class="code-container">

<label class="label-spacing">service.yaml</label>

<bkl-code class="code-labeled"><key>addr</key>: <string>127.0.0.1</string>
<key>name</key>: <string>myService</string>
<key>port</key>: <number>8080</number></bkl-code>
</div>


<div class="code-container">

<label class="label-spacing">service.test.toml</label>

<bkl-code class="code-labeled"><key>port</key> = <highlight><number>8081</number></highlight></bkl-code>
</div>

</div>
</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">Run it!</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ </prompt><command>bkl</command> <argument>service.test.toml</argument>
<key>addr</key> = <string>'127.0.0.1'</string>
<key>name</key> = <string>'myService'</string>
<key>port</key> = <highlight><number>8081</number></highlight></bkl-code>
</div>
</div>

</div>




<p>bkl automatically inherits <highlight>service.test.toml</highlight> from <highlight>service.yaml</highlight> by filename pattern and handles format conversion.
</p>



</section>

<section id="install">
<h2><a name="install">Install</a></h2>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">Using go</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><comment># Install go from <a href="https://go.dev/dl/">go.dev</a></comment>
<prompt>$ <command></prompt>go</command> <argument>install</argument> <argument>github.com/gopatchy/bkl/...@latest</argument></bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">brew (macOS)</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><comment># Install brew from <a href="https://brew.sh/">brew.sh</a></comment>
<prompt>$ <command></prompt>brew</command> <argument>install</argument> <argument>gopatchy/bkl/bkl</argument></bkl-code>
</div>
</div>

</div>




<p>Download binaries from <a href="https://github.com/gopatchy/bkl/releases">releases</a>.
</p>



</section>

<section id="formats">
<h2><a name="formats">Formats</a></h2>



<p>Output defaults to input format. Use <highlight>-f</highlight> to override.
</p>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">YAML</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ </prompt><command>bkl</command> <highlight><flag>-f</flag> <argument>yaml</argument></highlight> <argument>service.test.toml</argument>
<key>addr</key>: <string>127.0.0.1</string>
<key>name</key>: <string>myService</string>
<key>port</key>: <number>8081</number></bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">TOML</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ </prompt><command>bkl</command> <highlight><flag>-f</flag> <argument>toml</argument></highlight> <argument>service.test.toml</argument>
<key>addr</key> = <string>'127.0.0.1'</string>
<key>name</key> = <string>'myService'</string>
<key>port</key> = <number>8081</number></bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">JSON</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ </prompt><command>bkl</command> <highlight><flag>-f</flag> <argument>json</argument></highlight> <argument>service.test.toml</argument>
{<key>"addr"</key>:<string>"127.0.0.1"</string>,<key>"name"</key>:<string>"myService"</string>,<key>"port"</key>:<number>8081</number>}</bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">JSON (pretty)</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ </prompt><command>bkl</command> <highlight><flag>-f</flag> <argument>json-pretty</argument></highlight> <argument>service.test.toml</argument>
{
  <key>"addr"</key>: <string>"127.0.0.1"</string>,
  <key>"name"</key>: <string>"myService"</string>,
  <key>"port"</key>: <number>8081</number>
}</bkl-code>
</div>
</div>

</div>




<p><highlight>jsonl</highlight> is an alias for <highlight>json</highlight> (see <a href="https://jsonlines.org/">JSON Lines</a>). Format is auto-detected from file extensions.
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bkl</command> <argument>service.test.<highlight>yaml</argument></highlight>   <comment># real file is service.test.<highlight>toml</comment></highlight>
<key>addr</key>: <string>127.0.0.1</string>
<key>name</key>: <string>myService</string>
<key>port</key>: <number>8081</number></bkl-code>
</div>

</div>




</section>

<section id="write">
<h2><a name="write">Output</a></h2>



<p>Output goes to stdout by default. Use <highlight>-o</highlight> to write to a file.
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <command></prompt>bkl</command> <highlight><flag>-o</flag> <argument>out.yaml</argument></highlight> <argument>service.test.toml</argument></bkl-code>
</div>

</div>




<p>The output format is automatically detected from the output filename.
</p>



</section>

<section id="inputs">
<h2><a name="inputs">Inputs</a></h2>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">Commandline Layering</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ <command></prompt>bkl</command> <highlight><argument>a.b.yaml</argument> <argument>c.d.yaml</argument></highlight>   <comment># a.yaml + a.b.yaml + c.yaml + c.d.yaml</comment></bkl-code>
</div>
</div>

</div>




<p>Specifying multiple input files merges all layers in order.
</p>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">stdin</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ </prompt><command>bkl</command> <highlight><flag>--</flag> <flag>-.yaml</flag></highlight> <operator>&lt;<operator></operator>&lt;</operator><string>'EOF'</string>
<key>a</key>: <number>1</number>
<string>EOF</string></bkl-code>
</div>
</div>

</div>




<p>Use <highlight>-.yaml</highlight>, <highlight>-.json</highlight>, or <highlight>-.toml</highlight> to read from stdin. Prefix with <highlight>--</highlight> to prevent flag interpretation.
</p>



</section>

<section id="inheritance">
<h2><a name="inheritance">Inheritance</a></h2>



<p>Inheritance is determined using filenames by default. After stripping the extension, the remaining filename is split on <highlight>.</highlight> and treated as an inheritance hierarchy (e.g. <highlight>a.b.c.yaml</highlight> inherits from <highlight>a.b.&lt;ext&gt;</highlight> inherits from <highlight>a.&lt;ext&gt;</highlight>). Parent layers may have any supported file extension.
</p>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">Set Parent In File</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><highlight><key>$parent</key>: <string>a.b</string></highlight>   <comment># inherits from a.b.<ext>, from a.<ext></comment></bkl-code>
</div>
</div>

</div>




<p>bkl will check for all supported endings of a manually-specified parent file and will still evaluate layers under the parent in the normal order.
</p>




<div class="example-container">
<div class="grid-container grid-2-col">

<div class="code-container">

<label class="label-spacing">Parent List</label>

<bkl-code class="code-labeled"><highlight><key>$parent</key>:</highlight>
<highlight>- <string>a</string></highlight>
<highlight>- <string>b</string></highlight></bkl-code>
</div>


<div class="code-container">

<label class="label-spacing">Parent Wildcard</label>

<bkl-code class="code-labeled"><highlight><key>$parent</key>: <string>a.*</string></highlight></bkl-code>
</div>

</div>
</div>




<p><highlight>$parent</highlight> supports lists and wildcards for multiple inheritance. Wildcard <highlight>*</highlight> matches one segment only: <highlight>a.*</highlight> matches <highlight>a.b.yaml</highlight> but not <highlight>a.b.c.yaml</highlight>.
</p>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">Set Parent In CLI</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ <command></prompt>bkl</command> <highlight><argument>a.b.yaml</argument> <argument>c.d.yaml</argument></highlight>      <comment># a.yaml + a.b.yaml + c.yaml + c.d.yaml</comment></bkl-code>
</div>
</div>

</div>




<p>Layer order can be specified with commandline argument order.
</p>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">No Parent</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><highlight><key>$parent</key>: <bool>false</bool></highlight>   <comment># no further inheritance</comment></bkl-code>
</div>
</div>

</div>




<p>Setting <highlight>$parent</highlight> to <highlight>false</highlight> or <highlight>null</highlight> stops any further inheritance regardless of filename structure.
</p>



</section>

<section id="streams">
<h2><a name="streams">Streams</a></h2>



<p>Streams contain multiple documents in one file. YAML uses <highlight>---</highlight> delimiters. JSON formats use newlines (see <a href="https://jsonlines.org/">JSON Lines</a>).
</p>



<p>By default, child documents apply to all parent documents. Use <highlight>$match</highlight> to target specific documents.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<string>---</string>
<key>b</key>: <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<highlight><highlight><key>c</key>: <number>3</number></highlight></highlight>
<string>---</string>
<key>b</key>: <number>2</number>
<highlight><highlight><key>c</key>: <number>3</number></highlight></highlight></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<string>---</string>
<key>b</key>: <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>$match</key>:</highlight>
  <highlight><key>b</key>: <number>2</number></highlight>
<key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<string>---</string>
<key>b</key>: <number>2</number>
<highlight><key>c</key>: <number>3</number></highlight></bkl-code>

</div>

</div>
</div>





<p>The supplied pattern can match multiple documents and the updates will be applied to all of them. <highlight>$match: {}</highlight> matches any documents with a map as their root element, regardless of parent.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<string>---</string>
<key>b</key>: <number>2</number>
<string>---</string>
<key>a</key>: <number>1</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>$match</key>:</highlight>
  <highlight><key>a</key>: <number>1</number></highlight>
<key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<highlight><highlight><key>c</key>: <number>3</number></highlight></highlight>
<string>---</string>
<key>b</key>: <number>2</number>
<string>---</string>
<key>a</key>: <number>1</number>
<highlight><highlight><key>c</key>: <number>3</number></highlight></highlight></bkl-code>

</div>

</div>
</div>





<p><highlight>$invert: true</highlight> inside a <highlight>$match</highlight> block inverts the match, causing it to apply to any documents that do not contain the match criteria.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<string>---</string>
<key>b</key>: <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>$match</key>:</highlight>
  <key>a</key>: <number>1</number>
  <highlight><key>$invert</key>: <bool>true</bool></highlight>
<key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<string>---</string>
<key>b</key>: <number>2</number>
<highlight><key>c</key>: <number>3</number></highlight></bkl-code>

</div>

</div>
</div>





<p><highlight>$match: null</highlight> forces the updates to apply to a new document.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>$match</key>: <string>null</string></highlight>
<key>b</key>: <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<string>---</string>
<highlight><key>b</key>: <number>2</number></highlight></bkl-code>

</div>

</div>
</div>





</section>

<section id="maps">
<h2><a name="maps">Maps</a></h2>



<p>Maps are merged by default. Use <highlight>$replace: true</highlight> to replace the entire map or <highlight>$delete</highlight> to remove specific keys.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>b</key>: <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>b</key>: <number>2</number>
<highlight><key>$replace</key>: <bool>true</bool></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>b</key>: <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>c</key>: <number>3</number>
<highlight><key>b</key>: <string>$delete</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>c</key>: <number>3</number></bkl-code>

</div>

</div>
</div>





<p>bkl returns an error if you use <highlight>$delete</highlight>, <highlight>$replace: true</highlight>, or a <highlight>key: value</highlight> pair when they don't override a value from a lower layer. This helps keep upper layers minimal.
</p>



</section>

<section id="lists">
<h2><a name="lists">Lists</a></h2>



<p>Lists are merged by default. Use <highlight>$replace: true</highlight> to replace the entire list or <highlight>$delete</highlight> to remove specific entries.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <number>1</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <number>1</number>
- <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <number>1</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <number>2</number>
- <highlight><key>$replace</key>: <bool>true</bool></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <key>x</key>: <number>1</number>
- <key>x</key>: <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <key>x</key>: <number>3</number>
- <highlight><key>$delete</key>:</highlight>
    <highlight><key>x</key>: <number>2</number></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <key>x</key>: <number>1</number>
- <key>x</key>: <number>3</number></bkl-code>

</div>

</div>
</div>





<p>bkl returns an error if you use <highlight>$replace: true</highlight> or <highlight>$delete</highlight> when they don't override a value from a lower layer. This helps keep upper layers minimal.
</p>



<p>To update a specific list item, use <highlight>$match</highlight>. For scalar values in lists, use <highlight>$value</highlight> to replace the entire item.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number>
- <key>b</key>: <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <highlight><key>$match</key>:</highlight>
    <highlight><key>b</key>: <number>2</number></highlight>
  <key>b</key>: <number>10</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number>
- <key>b</key>: <number>10</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <number>1</number>
- <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <highlight><key>$match</key>: <number>2</number></highlight>
  <highlight><key>$value</key>: <number>10</number></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <number>1</number>
- <number>10</number></bkl-code>

</div>

</div>
</div>





</section>

<section id="interp">
<h2><a name="interp">$""</a></h2>



<p>Use <highlight>$""</highlight> to interpolate format strings with <a href="#merge"><highlight>$merge</highlight></a>-style references.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <key>c</key>: <string>foo</string>
<key>d</key>: <highlight><string>$"{b.c} bar {a} 2"</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <key>c</key>: <string>foo</string>
<key>d</key>: <highlight><string>foo bar 1 2</string></highlight></bkl-code>

</div>

</div>
</div>





</section>

<section id="decode">
<h2><a name="decode">$decode</a></h2>



<p><highlight>$decode</highlight> transforms a string into a tree by parsing standard formats.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>$value</key>: <string>|</string>
  <highlight><string>{"a":1}</string></highlight>
<highlight><key>$decode</key>: <string>json</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight></bkl-code>

</div>

</div>
</div>





</section>

<section id="env">
<h2><a name="env">$env</a></h2>



<p>Use <highlight>$env:</highlight> to substitute environment variables. This is supported in keys and values.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><comment># export FOO=test</comment>
<highlight><string><string>"$env:FOO"</string></highlight>: 1</string></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><highlight><key>test</key></highlight>: <number>1</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><comment># export FOO=test</comment>
<key>a</key>: <highlight><string>$env:FOO</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <highlight><string>test</string></highlight></bkl-code>

</div>

</div>
</div>





<p>Note that all <highlight>$env:</highlight> substitutions result in string values even if the substituted value is <highlight>true</highlight>, <highlight>false</highlight>, <highlight>null</highlight>, or all digits.
</p>



</section>

<section id="encode">
<h2><a name="encode">$encode</a></h2>



<p><highlight>$encode</highlight> transforms the subtree into the specified format.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">base64</label>

<bkl-code class="code-labeled"><key>$value</key>: <string>a</string>
<highlight><key>$encode</key>: <string>base64</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled"><string>YQ==</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">flags</label>

<bkl-code class="code-labeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<highlight><key>$encode</key>: <string>flags</string></highlight>
<comment># [tolist:=, prefix:--]</comment></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled">- <string>--a=1</string>
- <string>--b=2</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">flatten</label>

<bkl-code class="code-labeled">- <string>- a</string>
  - <string>b</string>
- <string>- c</string>
  - <number>4</number>
- <string>e</string>
- <highlight><key>$encode</key>: <string>flatten</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled">- <string>a</string>
- <string>b</string>
- <string>c</string>
- <number>4</number>
- <string>e</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">join</label>

<bkl-code class="code-labeled"><key>$value</key>: <string>[a, b]</string>
<highlight><key>$encode</key>: <string>join:/</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled"><string>a/b</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">json</label>

<bkl-code class="code-labeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<highlight><key>$encode</key>: <string>json</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled"><string>|</string>
  <string>{"a":1,"b":2}</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">json (list)</label>

<bkl-code class="code-labeled">- <key>a</key>: <number>1</number>
- <key>b</key>: <number>2</number>
- <highlight><key>$encode</key>: <string>json</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled"><string>|</string>
  <string>[{"a":1},{"b":2}]</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">prefix</label>

<bkl-code class="code-labeled">- <string>a</string>
- <number>2</number>
- <highlight><key>$encode</key>: <string>prefix:X</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled">- <string>Xa</string>
- <string>X2</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">sha256</label>

<bkl-code class="code-labeled"><key>$value</key>: <string>hello world</string>
<highlight><key>$encode</key>: <string>sha256</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled"><string>b94d27b9934d3e08a52e52d7da7dabfac484efe37a5380ee9088f7ace2efcde9</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">tolist</label>

<bkl-code class="code-labeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<highlight><key>$encode</key>: <string>tolist:=</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled">- <string>a=1</string>
- <string>b=2</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">values</label>

<bkl-code class="code-labeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<key>c</key>: <number>3</number>
<highlight><key>$encode</key>: <string>values</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled">- <number>1</number>
- <number>2</number>
- <number>3</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">values:name</label>

<bkl-code class="code-labeled"><key>a</key>:
  <key>b</key>: <number>1</number>
<key>c</key>:
  <key>d</key>: <number>2</number>
<highlight><key>$encode</key>: <string>values:name</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled">- <key>b</key>: <number>1</number>
  <key>name</key>: <string>a</string>
- <key>d</key>: <number>2</number>
  <key>name</key>: <string>c</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<label class="label-spacing">Stacking</label>

<bkl-code class="code-labeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<highlight><key>$encode</key>: <string>[tolist:=, "join:,"]</string></highlight></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled"><string>a=1,b=2</string></bkl-code>

</div>

</div>
</div>





</section>

<section id="required">
<h2><a name="required">$required</a></h2>



<p>Use <highlight>$required</highlight> in lower layers to force upper layers to replace the value.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<highlight><key>b</key>: <string>$required</string></highlight></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<div class="error-display">Error</div>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<highlight><key>b</key>: <string>$required</string></highlight></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>b</key>: <number>2</number></highlight>
<key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<key>c</key>: <number>3</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<highlight><key>b</key>:</highlight>
  <highlight>- <string>$required</string></highlight></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<div class="error-display">Error</div>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<highlight><key>b</key>:</highlight>
  <highlight>- <string>$required</string></highlight></bkl-code>
</div>



  

  
<div class="operator-symbol">&#43;</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>b</key>:</highlight>
  <highlight>- <number>2</number></highlight>
<key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  - <number>2</number>
<key>c</key>: <number>3</number></bkl-code>

</div>

</div>
</div>





</section>

<section id="merge">
<h2><a name="merge">$merge</a></h2>



<p>Use <highlight>$merge</highlight> to merge the contents one subtree or scalar value into another.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <key>a</key>: <number>1</number>
<key>zig</key>:
  <key>b</key>: <number>2</number>
  <highlight><key>$merge</key>: <string>foo.bar</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <highlight><key>a</key>: <number>1</number></highlight>
<key>zig</key>:
  <highlight><key>a</key>: <number>1</number></highlight>
  <key>b</key>: <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    - <key>a</key>: <number>1</number>
<key>zig</key>:
  - <key>b</key>: <number>2</number>
  - <highlight><key>$merge</key>: <string>foo.bar</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    - <highlight><key>a</key>: <number>1</number></highlight>
<key>zig</key>:
  - <key>b</key>: <number>2</number>
  - <highlight><key>a</key>: <number>1</number></highlight></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <key>a</key>: <number>1</number>
<key>zig</key>:
  <key>b</key>: <number>2</number>
  <key>c</key>: <highlight><string>$merge:foo.bar.a</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <key>a</key>: <highlight><number>1</number></highlight>
<key>zig</key>:
  <key>b</key>: <number>2</number>
  <key>c</key>: <highlight><number>1</number></highlight></bkl-code>

</div>

</div>
</div>





<p>You can also merge across documents using <highlight>$match</highlight> and optionally <highlight>$path</highlight>:
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<key>b</key>: <number>2</number>
<string>---</string>
<key>c</key>: <number>3</number>
<highlight><key>$merge</key>:</highlight>
  <highlight><key>$match</key>:</highlight>
    <highlight><key>a</key>: <number>1</number></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight>
<string>---</string>
<highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight>
<key>c</key>: <number>3</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<key>b</key>:
  <key>c</key>: <number>3</number>
<string>---</string>
<key>d</key>: <number>4</number>
<highlight><key>$merge</key>:</highlight>
  <highlight><key>$match</key>:</highlight>
    <highlight><key>a</key>: <number>1</number></highlight>
  <highlight><key>$path</key>: <string>b</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <highlight><key>c</key>: <number>3</number></highlight>
<string>---</string>
<highlight><key>c</key>: <number>3</number></highlight>
<key>d</key>: <number>4</number></bkl-code>

</div>

</div>
</div>





<p><highlight>$merge</highlight> supports a shorthand syntax: <highlight>$merge: [{pattern}, path]</highlight> is equivalent to using <highlight>$match</highlight> and <highlight>$path</highlight>.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<string>---</string>
<key>c</key>: <number>3</number>
<highlight><key>$merge</key>: <string>[{a: 1}]</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight>
<string>---</string>
<highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight>
<key>c</key>: <number>3</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <key>c</key>: <number>3</number>
<string>---</string>
<key>d</key>: <number>4</number>
<highlight><key>$merge</key>: <string>[{a: 1}, b]</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <highlight><key>c</key>: <number>3</number></highlight>
<string>---</string>
<highlight><key>c</key>: <number>3</number></highlight>
<key>d</key>: <number>4</number></bkl-code>

</div>

</div>
</div>





</section>

<section id="replace">
<h2><a name="replace">$replace</a></h2>



<p>Use <highlight>$replace</highlight> to merge the contents of one subtree or scalar value with another.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <key>a</key>: <number>1</number>
<key>zig</key>:
  <key>b</key>: <number>2</number>
  <highlight><key>$replace</key>: <string>foo.bar</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <highlight><key>a</key>: <number>1</number></highlight>
<key>zig</key>:
  <highlight><key>a</key>: <number>1</number></highlight></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    - <key>a</key>: <number>1</number>
<key>zig</key>:
  - <key>b</key>: <number>2</number>
  - <highlight><key>$replace</key>: <string>foo.bar</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    - <highlight><key>a</key>: <number>1</number></highlight>
<key>zig</key>:
  - <highlight><key>a</key>: <number>1</number></highlight></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <key>a</key>: <number>1</number>
<key>zig</key>:
  <key>b</key>: <number>2</number>
  <key>c</key>: <highlight><string>$replace:foo.bar.a</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <key>a</key>: <highlight><number>1</number></highlight>
<key>zig</key>:
  <key>b</key>: <number>2</number>
  <key>c</key>: <highlight><number>1</number></highlight></bkl-code>

</div>

</div>
</div>





<p>Note that <highlight>$merge</highlight> and <highlight>$replace</highlight> are equivalent for scalar values.
</p>



<p>You can also replace across documents using <highlight>$match</highlight> and optionally <highlight>$path</highlight>:
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<key>b</key>: <number>2</number>
<string>---</string>
<key>c</key>: <number>3</number>
<highlight><key>$replace</key>:</highlight>
  <highlight><key>$match</key>:</highlight>
    <highlight><key>a</key>: <number>1</number></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight>
<string>---</string>
<highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<key>b</key>:
  <key>c</key>: <number>3</number>
<string>---</string>
<key>d</key>: <number>4</number>
<highlight><key>$replace</key>:</highlight>
  <highlight><key>$match</key>:</highlight>
    <highlight><key>a</key>: <number>1</number></highlight>
  <highlight><key>$path</key>: <string>b</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <key>c</key>: <number>3</number>
<string>---</string>
<key>c</key>: <number>3</number></bkl-code>

</div>

</div>
</div>





<p><highlight>$replace</highlight> supports a shorthand syntax: <highlight>$replace: [{pattern}, path]</highlight> is equivalent to using <highlight>$match</highlight> and <highlight>$path</highlight>.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<string>---</string>
<key>c</key>: <number>3</number>
<highlight><key>$replace</key>: <string>[{a: 1}]</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight>
<string>---</string>
<highlight><key>a</key>: <number>1</number></highlight>
<highlight><key>b</key>: <number>2</number></highlight></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <key>c</key>: <number>3</number>
<string>---</string>
<key>d</key>: <number>4</number>
<highlight><key>$replace</key>: <string>[{a: 1}, b]</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>:
  <highlight><key>c</key>: <number>3</number></highlight>
<string>---</string>
<highlight><key>c</key>: <number>3</number></highlight></bkl-code>

</div>

</div>
</div>





</section>

<section id="output">
<h2><a name="output">$output</a></h2>



<p>Use <highlight>$output: true</highlight> to select a subtree for output instead of the document root.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    <highlight><key>$output</key>: <bool>true</bool></highlight>
    <key>a</key>: <number>1</number>
    <key>b</key>: <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>foo</key>:
  <key>bar</key>:
    - <highlight><key>$output</key>: <bool>true</bool></highlight>
    - <key>a</key>: <number>1</number>
    - <key>b</key>: <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number>
- <key>b</key>: <number>2</number></bkl-code>

</div>

</div>
</div>





<p>Multiple instances of <highlight>$output: true</highlight> in a document will generate multiple output documents (delimited with <highlight>---</highlight>).
</p>



<p>Use <highlight>$output: false</highlight> to omit a subtree or entire document from the output.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>:
  <key>b</key>: <number>1</number>
  <highlight><key>$output</key>: <bool>false</bool></highlight>
<key>c</key>:
  <key>d</key>: <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>c</key>:
  <key>d</key>: <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>:
  - <key>b</key>: <number>1</number>
  - <highlight><key>$output</key>: <bool>false</bool></highlight>
<key>c</key>:
  - <key>d</key>: <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>c</key>:
  - <key>d</key>: <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<highlight><key>$output</key>: <bool>false</bool></highlight>
<string>---</string>
<key>b</key>: <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>b</key>: <number>2</number></bkl-code>

</div>

</div>
</div>





<p>Combine <highlight>$output</highlight> with <highlight>$merge</highlight> to create reusable template sections.
</p>



</section>

<section id="repeat">
<h2><a name="repeat">$repeat</a></h2>



<p><highlight>$repeat:</highlight> at the top level of a document causes the document to be duplicated the given number of times. Within the document, <highlight>$repeat</highlight> can be used to reference the zero-based repeat index.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <string>foo</string>
<highlight><key>b</key>: <string>$repeat</string></highlight>
<highlight><key>$repeat</key>: <number>2</number></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <string>foo</string>
<key>b</key>: <number>0</number>
<string>---</string>
<key>a</key>: <string>foo</string>
<key>b</key>: <number>1</number></bkl-code>

</div>

</div>
</div>





<p><highlight>$repeat:</highlight> can also contain a map of named repeat iterators to repeat count. The result is the cartesian product (all combinations) of repeat values.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>$repeat</key>:</highlight>
  <highlight><key>a</key>: <number>2</number></highlight>
  <highlight><key>b</key>: <number>3</number></highlight>
<key>$value</key>: <string>$"{<highlight><highlight>$repeat:</highlight>a</highlight>},{<highlight><highlight>$repeat:</highlight>b</highlight>}"</string></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><string>0,0</string>
<string>---</string>
<string>0,1</string>
<string>---</string>
<string>0,2</string>
<string>---</string>
<string>1,0</string>
<string>---</string>
<string>1,1</string>
<string>---</string>
<string>1,2</string></bkl-code>

</div>

</div>
</div>





<p><highlight>$repeat:</highlight> can contain a list of values to iterate over:
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>$repeat</key>: <string>[foo, bar, baz]</string></highlight>
<highlight><key>a</key>: <string>$repeat</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <string>foo</string>
<string>---</string>
<key>a</key>: <string>bar</string>
<string>---</string>
<key>a</key>: <string>baz</string></bkl-code>

</div>

</div>
</div>





<p><highlight>$repeat:</highlight> supports range parameters for numeric sequences:
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><highlight><key>$repeat</key>:</highlight>
  <highlight><key>$first</key>: <number>10</number></highlight>
  <highlight><key>$count</key>: <number>3</number></highlight>
<highlight><key>a</key>: <string>$repeat</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>10</number>
<string>---</string>
<key>a</key>: <number>11</number>
<string>---</string>
<key>a</key>: <number>12</number></bkl-code>

</div>

</div>
</div>





<p>Range parameters require exactly 2 of <highlight>$first</highlight>, <highlight>$last</highlight>, and <highlight>$count</highlight>. Optional <highlight>$step</highlight> defaults to 1.
</p>



<p><highlight>$repeat:</highlight> also works at the object level within maps and lists:
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>:
  <key>$"b{$repeat}"</key>:
    <highlight><key>c</key>: <string>$repeat</string></highlight>
    <highlight><key>$repeat</key>: <number>3</number></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>:
  <key>b0</key>:
    <key>c</key>: <number>0</number>
  <key>b1</key>:
    <key>c</key>: <number>1</number>
  <key>b2</key>:
    <key>c</key>: <number>2</number></bkl-code>

</div>

</div>
</div>





<p>Object-level repeat in lists:
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>:
  - <highlight><key>b</key>: <string>$repeat</string></highlight>
    <highlight><key>$repeat</key>: <string>[foo, bar, baz]</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>:
  - <key>b</key>: <string>foo</string>
  - <key>b</key>: <string>bar</string>
  - <key>b</key>: <string>baz</string></bkl-code>

</div>

</div>
</div>





</section>

<section id="defer">
<h2><a name="defer">$defer</a></h2>



<p>Use <highlight>$defer: true</highlight> to process a document after all non-deferred documents have been fully evaluated.
</p>



<p>This allows operations on the final output after transformations like <highlight>$repeat</highlight> have been applied.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<label class="label-spacing">a.yaml</label>

<bkl-code class="code-labeled"><key>$repeat</key>: <number>2</number>
<key>a</key>: <string>$repeat</string></bkl-code>
</div>



  

  
<div class="operator-symbol operator-with-label">&#43;</div>





<div class="code-container">

<label class="label-spacing">a.b.yaml</label>

<bkl-code class="code-labeled"><key>$repeat</key>: <number>3</number>
<string>---</string>
<highlight><key>$defer</key>: <bool>true</bool></highlight>
<key>$match</key>:
  <key>a</key>: <number>2</number>
<key>b</key>: <string>special</string></bkl-code>
</div>




<div class="operator-symbol operator-with-label">=</div>


<div class="code-container">

<label class="invisible label-spacing">invisible</label>


<bkl-code class="code-labeled"><key>a</key>: <number>0</number>
<string>---</string>
<key>a</key>: <number>1</number>
<string>---</string>
<key>a</key>: <number>2</number>
<highlight><key>b</key>: <string>special</string></highlight></bkl-code>

</div>

</div>
</div>





</section>

<section id="escape">
<h2><a name="escape">$$</a></h2>



<p><highlight>$$</highlight> translates to a literal <highlight>$</highlight> in cases where it would otherwise trigger special handling.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <highlight><string>$$env:foo</string></highlight></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <highlight><string>$env:foo</string></highlight></bkl-code>

</div>

</div>
</div>





</section>

<section id="toml">
<h2><a name="toml">TOML</a></h2>



<p>TOML doesn't allow unquoted <highlight>$</highlight> in keys. Quote keys containing bkl directives:
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><highlight><key>"$parent"</highlight> </key>= <bool>false</bool></bkl-code>
</div>

</div>




</section>

<section id="bklb">
<h2><a name="bklb">bklb</a></h2>



<p><highlight>bklb</highlight> is a wrapper for CLI programs that take configuration files as commandline arguments but do not support bkl format. It transparently merges layers, translates formats, writes to temporary files, alters the commandline arguments, then execs the wrapped program.
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <highlight></prompt><command>ln</command> <flag>-s</flag> <argument>~/go/bin/bklb</argument> <argument>~/go/bin/catb</argument></highlight>   <comment># catb could be, e.g. kubectlb</comment>

<prompt>$ </prompt><command>cat</command> <argument>service.yaml</argument>
<key>addr</key>: <string>127.0.0.1</string>
<key>name</key>: <string>myService</string>
<key>port</key>: <number>8080</number>

<prompt>$ </prompt><command>cat</command> <argument>service.test.toml</argument>
<key>port</key> = <number>8081</number>

<prompt>$ <highlight></prompt><command>catb</command> <argument>service.test.toml</argument></highlight>
<key>addr</key> = <string>"127.0.0.1"</string>
<key>name</key> = <string>"myService"</string>
<key>port</key> = <number>8081</number>

<prompt>$ <command></prompt>cat</command> <argument>service.test.yaml</argument> <argument>service.test.json</argument>
<argument>cat:</argument> <argument>service.test.yaml:</argument> <argument>No</argument> <argument>such</argument> <argument>file</argument> <argument>or</argument> <argument>directory</argument>
<argument>cat:</argument> <argument>service.test.json:</argument> <argument>No</argument> <argument>such</argument> <argument>file</argument> <argument>or</argument> <argument>directory</argument>

<prompt>$ <highlight></prompt><command>catb</command> <argument>service.test.yaml</argument></highlight>
<key>addr</key>: <string>127.0.0.1</string>
<key>name</key>: <string>myService</string>
<key>port</key>: <number>8081</number>

<prompt>$ <highlight><command></prompt>catb</command> <argument>service.test.json</argument></highlight>
{<key>"addr"</key>:<string>"127.0.0.1"</string>,<key>"name"</key>:<string>"myService"</string>,<key>"port"</key>:<number>8081</number>}</bkl-code>
</div>

</div>




<p>Note that the files mentioned don't have to exist; <highlight>bklb</highlight> will search for files with the same root name but different extensions, then merge layers and translate into the specified format.
</p>



<p><highlight>bklb</highlight> takes the name of the program it wraps from its own filename, hence the <highlight>ln -s</highlight> symlink creation in the example above. It trims at most one <highlight>b</highlight> from the end of its name before searching for the wrapped program so they can coexist in your PATH.
</p>



</section>

<section id="bkld">
<h2><a name="bkld">bkld</a></h2>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bkld</command> <operator>&lt;</operator><argument>base_layer_path</argument><operator>&gt;</operator> <operator>&lt;</operator><argument>target_output_path</argument><operator>&gt;</operator></bkl-code>
</div>

</div>




<p><highlight>bkld</highlight> (d for "diff") generates the minimal intermediate layer needed to create the target output from the base layer. Along with <highlight><a href="#bkli">bkli</a></highlight>, it automates splitting existing configurations into layers.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <string>$required</string>
<key>c</key>: <number>3</number></bkl-code>
</div>



  

  
<div class="operator-symbol">?</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<key>d</key>: <number>4</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>$match</key>: <string>{}</string>
<key>b</key>: <number>2</number>
<key>c</key>: <string>$delete</string>
<key>d</key>: <number>4</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number>
- <key>b</key>: <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">?</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number>
- <key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <key>$match</key>: <string>{}</string>
- <key>c</key>: <number>3</number>
- <key>$delete</key>:
    <key>b</key>: <number>2</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <number>1</number>
- <number>2</number></bkl-code>
</div>



  

  
<div class="operator-symbol">?</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <number>1</number>
- <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <key>$match</key>: <string>{}</string>
- <number>1</number>
- <number>3</number>
- <key>$replace</key>: <bool>true</bool></bkl-code>

</div>

</div>
</div>





</section>

<section id="bkli">
<h2><a name="bkli">bkli</a></h2>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>bkli</command> <operator>&lt;</operator><argument>target_output_path</argument><operator>&gt;</operator> <operator>&lt;</operator><argument>target_output_path</argument><operator>&gt;</operator> <command>...</command></bkl-code>
</div>

</div>




<p><highlight>bkli</highlight> (i for "intersect") generates the maximal base layer that the specified targets have in common. Along with <highlight><a href="#bkld">bkld</a></highlight>, it automates splitting existing configurations into layers.
</p>



<p>Fields that exist in all inputs with the same value are included in the result. Fields with different values are omitted.
</p>












  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>2</number>
<key>c</key>: <number>3</number></bkl-code>
</div>



  

  
<div class="operator-symbol">âˆ©</div>





<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number>
<key>b</key>: <number>10</number>
<key>d</key>: <number>4</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>: <number>1</number></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-5-col">



<div class="code-container">

<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number>
- <key>b</key>: <number>2</number>
- <key>c</key>: <number>3</number></bkl-code>
</div>



  

  
<div class="operator-symbol">âˆ©</div>





<div class="code-container">

<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number>
- <key>b</key>: <number>10</number>
- <key>d</key>: <number>4</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled">- <key>a</key>: <number>1</number></bkl-code>

</div>

</div>
</div>





</section>

<section id="bklr">
<h2><a name="bklr">bklr</a></h2>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <command></prompt>bklr</command> <operator>&lt;<argument></operator>lower_layer_path<operator></argument>&gt;</operator></bkl-code>
</div>

</div>




<p><highlight>bklr</highlight> extracts only <highlight>$required</highlight> fields and their parent paths. Use this output as a template for creating minimal upper layers.
</p>












  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>:
  <key>b</key>: <string>$required</string>
  <key>c</key>: <number>3</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>:
  <key>b</key>: <string>$required</string></bkl-code>

</div>

</div>
</div>














  

<div class="example-container">
<div class="grid-container grid-3-col">



<div class="code-container">

<bkl-code class="code-unlabeled"><key>a</key>:
  - <string>$required</string>
<key>b</key>:
  - <number>2</number></bkl-code>
</div>




<div class="operator-symbol">=</div>


<div class="code-container">


<bkl-code class="code-unlabeled"><key>a</key>:
  - <string>$required</string></bkl-code>

</div>

</div>
</div>





</section>

<section id="kubectl-bkl">
<h2><a name="kubectl-bkl">kubectl bkl</a></h2>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ </prompt><command>kubectl</command> <highlight><argument>bkl</argument></highlight> <operator>&lt;</operator><argument>kubectl_commands</argument><operator>&gt;</operator></bkl-code>
</div>

</div>




<p><highlight>kubectl bkl</highlight> is a kubectl plugin that wraps all the normal kubectl commands by evaluating any input files as bkl layers and passing the output to kubectl.
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><comment># deploy.dev.yaml and deploy.yaml are bkl layer files</comment>
<prompt>$ </prompt><command>kubectl</command> <argument>bkl</argument> <argument>apply</argument> <flag>-f</flag> <argument>deploy.dev.yaml</argument>
<argument>deployment.apps/deploy-dev</argument> <argument>unchanged</argument></bkl-code>
</div>

</div>




</section>

<section id="diff">
<h2><a name="diff">Comparing Files</a></h2>



<p>Compare evaluated bkl files using standard diff tools:
</p>




<div class="example-container">

<div class="code-wrapper">

<bkl-code class="code-unlabeled"><prompt>$ <highlight></prompt><command>diff</command> <flag>-ud</flag> <flag>--color</flag> <operator>&lt;</operator><operator>(</operator><command>bkl</command> <argument>a.yaml</argument><operator>)</operator> <operator>&lt;</operator><operator>(</operator><command>bkl</command> <argument>b.yaml</argument><operator>)</operator></highlight>
<file-header>--- /dev/fd/63  2023-07-12 21:00:55.412475845 -0700</file-header>
<file-header>+++ /dev/fd/62  2023-07-12 21:00:55.412475845 -0700</file-header>
<hunk-header>@@ -1,3 +1,2 @@</hunk-header>
 a: 1
<deletion>-b: 2</deletion>
 c: 3

<prompt>$ <highlight></prompt><command>diff</command> <flag>-y</flag> <flag>--color</flag> <operator>&lt;</operator><operator>(</operator><command>bkl</command> <argument>a.yaml<operator></argument>)</operator> <operator>&lt;</operator><operator>(</operator><command>bkl</command> <argument>b.yaml</argument><operator>)</operator></highlight>
a: 1                              a: 1
b: 2                            &lt;
c: 3                              c: 3</bkl-code>
</div>

</div>




</section>

<section id="migrate">
<h2><a name="migrate">Migrate</a></h2>



<p>Below is an example process for migrating an existing set of configurations to <highlight>bkl</highlight>. It contains some Kubernetes-specific items but the use of the <highlight>bkl*</highlight> tools applies to any configuration source.
</p>



<p>We assume you start with two K8s deployments called <highlight>deploy-dev</highlight> and <highlight>deploy-prod</highlight> which are similar but not identical.
</p>



<p>First, install tools:

<ul>
<li><a href="#install">bkl</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/#kubectl">kubectl</a></li>
<li><a href="https://krew.sigs.k8s.io/docs/user-guide/setup/install/">krew</a></li>
<li><a href="https://github.com/itaysk/kubectl-neat#installation">neat</a></li>
</ul>
</p>



<p>It's possible to export configuration directly from existing templating systems (e.g. <highlight>kustomize build</highlight>, <highlight>helm install --dry-run --debug</highlight>). Instead, we do this in a generic way and make sure we get the latest configuration by fetching it directly from the K8s API server.
</p>




<div class="example-container">

<div class="label-container">
<label class="label-spacing">Export Existing Config</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><comment># "kubectl neat" removes status and default value fields</comment>
<prompt>$ </prompt><command>kubectl</command> <argument>neat</argument> <argument>get</argument> <flag>--</flag> <argument>deploy</argument> <argument>deploy-dev</argument> <operator>&gt;</operator> <command>deploy-dev-orig.yaml</command>
<prompt>$ </prompt><command>kubectl</command> <argument>neat</argument> <argument>get</argument> <flag>--</flag> <argument>deploy</argument> <argument>deploy-prod</argument> <operator>&gt;</operator> <command>deploy-prod-orig.yaml</command></bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">Generate Base Layer</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><comment># See bkli details <a href="#bkli">here</a></comment>
<prompt>$ </prompt><command>bkli</command> <flag>-o</flag> <argument>deploy.yaml</argument> <argument>deploy-dev-orig.yaml</argument> <argument>deploy-prod-orig.yaml</argument></bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">Generate Service Layers</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><comment># See bkld details <a href="#bkld">here</a></comment>
<prompt>$ </prompt><command>bkld</command> <flag>-o</flag> <argument>deploy.dev.yaml</argument> <argument>deploy.yaml</argument> <argument>deploy-dev-orig.yaml</argument>
<prompt>$ </prompt><command>bkld</command> <flag>-o</flag> <argument>deploy.prod.yaml</argument> <argument>deploy.yaml</argument> <argument>deploy-prod-orig.yaml</argument></bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">Check Results</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><comment># Should show no diff</comment>
<prompt>$ </prompt><command>kubectl</command> <argument>bkl</argument> <argument>diff</argument> <flag>-f</flag> <argument>deploy.dev.yaml</argument>
<prompt>$ </prompt><command>kubectl</command> <argument>bkl</argument> <argument>diff</argument> <flag>-f</flag> <argument>deploy.prod.yaml</argument></bkl-code>
</div>
</div>

</div>





<div class="example-container">

<div class="label-container">
<label class="label-spacing">Clean Up</label>
<div class="code-wrapper">

<bkl-code class="code-labeled"><prompt>$ <command></prompt>rm</command> <argument>deploy-dev-orig.yaml</argument> <argument>deploy-prod-orig.yaml</argument></bkl-code>
</div>
</div>

</div>




<p>You now have 3 bkl files:

<ul>
<li><highlight>deploy.yaml</highlight> is the base layer containing values common to both deployments</li>
<li><highlight>deploy.dev.yaml</highlight> is the upper layer containing values specific to <highlight>deploy-dev</highlight></li>
<li><highlight>deploy.prod.yaml</highlight> is the upper layer containing values specific to <highlight>deploy-prod</highlight></li>
</ul>
</p>



<p>The migration process isn't deterministic; there are design and aesthetic considerations. Here are some general tips:

<ul>
<li>Start with the most similar examples to maximize base layer size</li>
<li>Consider intermediate layers that make sense (e.g. <highlight>deploy.yaml</highlight> â†’ <highlight>deploy.frontend.yaml</highlight> â†’ <highlight>deploy.frontend.prod.yaml</highlight>)</li>
<li>Split large configurations into logical subfiles; bkl can merge across file boundaries</li>
<li>Iterate by diffing your evaluated layers against production (e.g. <highlight>kubectl bkl diff -f</highlight>), making small changes, then diffing again.</li>
<li>Migrate as much as possible to the lowest layer to reduce duplication and complexity.</li>
<li>Consider making your base layer match your production configuration then overriding values for dev/test configurations. This makes it very clear where you're drifting away from production.</li>
<li>Remove duplication with <highlight>$merge:</highlight> but avoid chained merge paths.</li>
<li>Avoid using hidden <highlight>$output: false</highlight> trees as template variables; prefer overriding values in-place.</li>
<li><highlight>bkld</highlight> doesn't know how to match entries within lists, so it may remove and replace large entries (e.g. K8s <highlight>containers</highlight>) that could be trivially patched. Use <highlight>$match:</highlight> to select the container and override values within it.</li>
</ul>
</p>



</section>

<section id="comparison">
<h2><a name="comparison">Comparison</a></h2>



<p>bkl has some overlap with other configuration templating tools (e.g. <a href="https://helm.sh/">Helm</a>, <a href="https://kustomize.io/">Kustomize</a>, <a href="https://www.puppet.com/docs/puppet/8/hiera_intro.html">Hiera</a>). We believe that bkl has a combination of project goals that aren't fully served by any of the alternatives:

<ul>
<li>Configuration and templating/layering should be generic, not service-specific.</li>
<li>Configuration and templating/layering should be separate from deployment tooling.</li>
<li>Configuration files should be written in standard formats (JSON, YAML, TOML) and parseable by their standard parsers.</li>
<li>Basic functionality should be available without learning custom syntax.</li>
<li>Non-templatized configuration (e.g. StackOverflow answers) should be usable without modification.</li>
<li>File composition should be accomplished without meta configuration (e.g. manifest files).</li>
<li>Templating/layering behavior should be intuitive and produce expected results.</li>
<li>Documentation and examples should be excellent.</li>
</ul>
</p>



</section>


</main>

<script>

function toggleMobileMenu() {
    const nav = document.querySelector('nav');
    const button = document.querySelector('.mobile-menu-button');
    nav.classList.toggle('mobile-open');
    button.textContent = nav.classList.contains('mobile-open') ? 'âœ• Close' : 'â˜° Nav';
}


function toggleExpand(button) {
    const wrapper = button.closest('.code-wrapper');
    const codeBlock = wrapper.querySelector('bkl-code');
    const isCollapsed = codeBlock.classList.contains('collapsed');
    
    if (isCollapsed) {
        codeBlock.classList.remove('collapsed');
        button.textContent = 'âˆ¨';
        button.setAttribute('aria-expanded', 'true');
    } else {
        codeBlock.classList.add('collapsed');
        button.textContent = 'â€º';
        button.setAttribute('aria-expanded', 'false');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const searchBar = document.getElementById('searchBar');
    const sections = Array.from(document.querySelectorAll('main > section'));
    const navList = document.querySelector('nav ol');
    const navItems = Array.from(navList.querySelectorAll('li'));
    
    
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            const nav = document.querySelector('nav');
            const button = document.querySelector('.mobile-menu-button');
            if (nav.classList.contains('mobile-open')) {
                nav.classList.remove('mobile-open');
                button.textContent = 'â˜° Nav';
            }
        });
    });
    
    const originalOrder = sections.map((section, index) => ({
        element: section,
        navItem: navItems[index],
        id: section.id,
        title: section.querySelector('h2').textContent.toLowerCase(),
        content: section.textContent.toLowerCase()
    }));

    searchBar.addEventListener('input', function() {
        const query = this.value.toLowerCase().trim();
        
        if (!query) {
            const main = document.querySelector('main');
            originalOrder.forEach(item => {
                main.appendChild(item.element);
                navList.appendChild(item.navItem);
            });
            window.scrollTo(0, 0);
            return;
        }

        const scored = originalOrder.map(item => {
            let score = 0;
            const keywords = query.split(/\s+/);
            
            keywords.forEach(keyword => {
                if (item.title.includes(keyword)) {
                    score += 5;
                }
                let index = 0;
                let matches = 0;
                while ((index = item.content.indexOf(keyword, index)) !== -1) {
                    matches++;
                    index += keyword.length;
                }
                score += matches;
            });
            
            return { ...item, score };
        });

        const main = document.querySelector('main');
        scored.sort((a, b) => b.score - a.score);
        
        scored.forEach(item => {
            main.appendChild(item.element);
            navList.appendChild(item.navItem);
        });
        
        window.scrollTo(0, 0);
    });
});
</script>

</body>
</html>
